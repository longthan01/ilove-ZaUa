!function(e){function t(t){for(var i,o,r=t[0],u=t[1],l=t[2],c=0,p=[];c<r.length;c++)o=r[c],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&p.push(s[o][0]),s[o]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);for(h&&h(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,o=1;o<n.length;o++){var u=n[o];0!==s[u]&&(i=!1)}i&&(a.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},o={23:0},s={23:0},a=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.e=function(e){var t=[];o[e]?t.push(o[e]):0!==o[e]&&{38:1,39:1,40:1}[e]&&t.push(o[e]=new Promise((function(t,n){for(var i=({7:"countries",16:"lang-en",17:"lang-vi"}[e]||e)+".1c41c23311c8b15682aa.css",s=r.p+i,a=document.getElementsByTagName("link"),u=0;u<a.length;u++){var l=(h=a[u]).getAttribute("data-href")||h.getAttribute("href");if("stylesheet"===h.rel&&(l===i||l===s))return t()}var c=document.getElementsByTagName("style");for(u=0;u<c.length;u++){var h;if((l=(h=c[u]).getAttribute("data-href"))===i||l===s)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var i=t&&t.target&&t.target.src||s,a=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=i,delete o[e],p.parentNode.removeChild(p),n(a)},p.href=s,document.getElementsByTagName("head")[0].appendChild(p)})).then((function(){o[e]=0})));var n=s[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,i){n=s[e]=[t,i]}));t.push(n[2]=i);var a,u=document.createElement("script");u.charset="utf-8",u.timeout=120,r.nc&&u.setAttribute("nonce",r.nc),u.src=function(e){return r.p+"lazy/"+({7:"countries",16:"lang-en",17:"lang-vi"}[e]||e)+"."+{7:"f3154653b05be0ae842e",16:"b5f2f7c446df81f918ad",17:"c18e31f25a079898d6ac",35:"c9caca38b90da9f3e280",36:"6eb555b501a69498ab63",37:"c5e940a22d3b4b27100a",38:"ee9965cdefe5234346af",39:"28ea051c980c2bb3673d",40:"aeeb1b90de034ceceae1",41:"ed020c7dde7db1e7a63d",42:"4279ee5095da4aa3492e",43:"f6ab9df9fce6c73995a6"}[e]+".js"}(e);var l=new Error;a=function(t){u.onerror=u.onload=null,clearTimeout(c);var n=s[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+i+": "+o+")",l.name="ChunkLoadError",l.type=i,l.request=o,n[1](l)}s[e]=void 0}};var c=setTimeout((function(){a({type:"timeout",target:u})}),12e4);u.onerror=u.onload=a,document.head.appendChild(u)}return Promise.all(t)},r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw e};var u=this.webpackJsonp=this.webpackJsonp||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var c=0;c<u.length;c++)t(u[c]);var h=l;a.push([3,0,4,3,6,31,2,1,5,11,9]),n()}({"/0p4":function(e,t){e.exports=require("events")},"14cR":function(e,t){e.exports=require("punycode")},3:function(e,t,n){e.exports=n("r29l")},"7WL4":function(e,t){e.exports=require("https")},"89t2":function(e,t){e.exports=require("perf_hooks")},"8JxD":function(e,t,n){},"8xkj":function(e,t){e.exports=require("querystring")},CgVK:function(e,t){e.exports=require("constants")},EXGp:function(e,t){e.exports=require("..\\native\\nativelibs")},FMKJ:function(e,t){e.exports=require("zlib")},KEll:function(e,t){e.exports=require("http")},NLsH:function(e,t){e.exports=require("electron")},NkYg:function(e,t){e.exports=require("buffer")},PJMN:function(e,t){e.exports=require("crypto")},QduZ:function(e,t){e.exports=require("child_process")},Qs2e:function(e,t){e.exports=require("net")},Qs3B:function(e,t){e.exports=require("assert")},WrSY:function(e,t,n){"use strict";n("EmOc"),n("ezdo"),n("KdAX"),n("mzek"),n("v/rv"),n("nAZb"),n("c0KM"),n("zheM"),n("CXIs"),n("cZjg");var i=n("YrRS");Object(i.a)()},bzos:function(e,t){e.exports=require("url")},jK02:function(e,t){e.exports=require("util")},"jle/":function(e,t){e.exports=require("os")},msIP:function(e,t){e.exports=require("stream")},"mw/K":function(e,t){e.exports=require("fs")},oyvS:function(e,t){e.exports=require("path")},r29l:function(e,t,n){"use strict";n.r(t);n("iGh7"),n("eqHM"),n("xDXR"),n("WrSY"),n("8ogj"),n("HpD8"),n("RGaR");var i=n("Ff2n"),o=n("wx14");n("cOPa");window.global=globalThis;n("dThN"),n("z0WU");var s=n("q1tI"),a=n.n(s),r=n("i8i4"),u=n.n(r),l=n("NDmK"),c=n("e0gR"),h=n("AtyM"),p=n("6e5J"),f=n("q1L6"),d=n("VTBJ"),_=n("hZSv");const{OS:m,GENERATOR_TYPE:g,THUMB_ERR:E,TEXT_THUMB_LIMIT:T}=_.a;let b,O,P,F,w,y,I,S,C;b=n("g+8e"),O=n("oyvS"),P=n("Dprd").default,F=n("EXGp"),w=n("OreS"),y=n("/kjY"),I=n("5wAm"),S=n("DcVv"),C=n("lRFz");const R={createThumbGenerator:e=>{switch(e){case g.PDF:return M;case g.PICTURE:return D;case g.OFFICE:return Object.assign({},L).createOfficeThumbGenerator("WIN32");case g.TEXT:return A}}},L={createOfficeThumbGenerator:function(e){switch(e){case m.DARWIN:return this.macGenerator.bind(this);case m.WIN32:return this.winGenerator.bind(this)}},winGenerator:function(e){return e.options&&e.options.useBuffer?this._winGeneratorBuffer(e,{fs:b,path:O,FileUtils:P,unusedFilename:w,getSavePath:f.a.getSavePath,writetoFileStream:f.a.writetoFileStream}):this._winGenerator(e,{fs:b,path:O,FileUtils:P,nodeUtils:F,unusedFilename:w})},_winGeneratorBuffer:function(e,t){return new Promise(((n,i)=>{if(e.options&&!e.fBuffer)return i(E.OFFICE_WIN_GEN_THUMB_USE_BUFFER_BUFFER_NOT_VALID);if(!e.options.savePath)return i(E.SAVE_PATH_EMPTY);let o=e.options.savePath;let s,a=new S(e.fBuffer).getEntries();for(let e of a)if("docProps/thumbnail.jpeg"==e.entryName){s=e;break}s?t.writetoFileStream(o,s.getData(),(e=>{if(e)return i(E.OFFICE_WIN_THUMB_BUFFER_GEN_FAIL);let t=p.default.getDimensionSync(s.getData());t.error?i(E.OFFICE_WIN_THUMB_GEN_GET_DIMENSION_FAIL):n({savePath:o,tDimension:{width:t.width,height:t.height}})})):i(E.OFFICE_WIN_THUMB_BUFFER_GEN_FAIL)}))},_winGenerator:function(e,t){return new Promise(((n,i)=>{if(!t.nodeUtils)return i(E.OFFICE_WIN_GEN_THUMB_NATIVE_LIB_NOT_LOADED);let o;try{o=t.nodeUtils.winUtils()}catch(l){}const{qlWin:s}=o||{};if(!s)return i(E.OFFICE_WIN_GEN_THUMB_REQUIRE_ERROR);if(!e.options.savePath)return i(E.SAVE_PATH_EMPTY);let a=e.options.savePath,r=t.path.basename(e.localPath).split(".")[0],u=t.unusedFilename.sync(t.path.join(t.FileUtils.getUserTempDirectory(),r+"."+e.options.ext));t.fs.copy(e.localPath,u,(e=>{if(e)return i(E.OFFICE_WIN_COPY_FILE_FOR_THUMB_GEN_ERROR);try{s(u,a),n({savePath:a})}catch(t){i(E.OFFICE_WIN_THUMB_GEN_FAIL)}}))}))},macGenerator:function(e){return this._macGenerator(e,{fs:b,unusedFilename:w,path:O,FileUtils:P,getOutputFromCommandMacOs:f.a.getOutputFromCommandMacOs})},_macGenerator:function(e,t){return new Promise(((n,i)=>{if(!e.options.savePath)return i(E.SAVE_PATH_EMPTY);let o=e.options.savePath,s=t.path.basename(e.localPath).split(".")[0],a=t.unusedFilename.sync(t.path.join(t.FileUtils.getUserTempDirectory(),s+"."+e.options.ext));t.fs.copy(e.localPath,a,(e=>{if(e)return i(E.OFFICE_MAC_COPY_FILE_FOR_THUMB_GEN_ERROR);let s=a+".png",r=`qlmanage -r cache && qlmanage -r && qlmanage -t -s 600  "${a}" -o "${t.FileUtils.getUserTempDirectory()}"`;t.getOutputFromCommandMacOs(r).then((e=>{if(!(e&&e.indexOf("produced one thumbnail")>-1))return i(E.OFFICE_MAC_THUMB_GEN_FAIL);t.fs.copy(s,o,(e=>{if(e)return i(E.OFFICE_MAC_COPY_GENED_THUMB_TO_CACHE_DIR_FAIL);n({savePath:o})}))})).catch((()=>i(E.OFFICE_MAC_THUMB_GEN_FAIL)))}))}))}},N=C;try{N.GlobalWorkerOptions.workerSrc=__SRC_PDF_WORKER__,N.$$pdfWorker=new N.PDFWorker}catch(Pe){}const B={createPdfLib:function(e){return this.jsLib(e,{readFile:f.a.readFile.bind(f.a),calculateOutputDimension:f.a.calculateOutputDimension.bind(f.a),writetoFileStream:f.a.writetoFileStream.bind(f.a),getRaf:f.a.getRaf.bind(f.a),PDFJS:N})},jsLib:(e,t)=>new Promise(((n,i)=>{if(t.PDFJS){if(!e.options.savePath)return i(E.SAVE_PATH_EMPTY);let o=e.options.savePath;const s=e=>{N.$$pdfWorker||(N.$$pdfWorker=new t.PDFJS.PDFWorker);let s=t.PDFJS.getDocument({data:e,worker:N.$$pdfWorker});s.onPassword=()=>{i(E.PDF_GEN_THUMB_PASSWORD)},s.promise.then((e=>{e.getPage(1).then((e=>{let s=e.getViewport({scale:1}),a=document.createElement("canvas"),r=a.getContext("2d");a.height=s.height,a.width=s.width;e.render({intent:t.getRaf()?"display":"print",canvasContext:r,viewport:s}).promise.then((()=>{let e=document.createElement("canvas"),r=e.getContext("2d"),{outputW:u,outputH:l}=t.calculateOutputDimension({width:s.width,height:s.height});if(!l||!u)return i(E.PDF_THUMB_RESIZE_DIMENSION_EMPTY);e.width=u,e.height=l,r.drawImage(a,0,0,u,l),e.toBlob((e=>{let s=new FileReader;s.onload=()=>{let e=new Buffer(s.result);t.writetoFileStream(o,e,(e=>{e?i(E.SAVE_THUMB_FILE_ERROR):n({savePath:o,tDimension:{width:u,height:l}})}))},s.readAsArrayBuffer(e)}),"image/jpeg",.8)})).catch((()=>{i(E.PDF_GEN_THUMB_CANVAS_RENDER_ERROR)}))})).catch((()=>{i(E.PDF_GEN_THUMB_GET_PAGE_ERROR)}))})).catch((()=>{i(E.PDF_GEN_THUMB_LOADIND_ERROR)}))};e.options&&e.options.useBuffer?s(e.fBuffer):t.readFile(e.localPath).then((e=>{s(e)})).catch(i)}else i(E.PDF_GEN_THUMB_JS_LIB_NOT_LOAD)})),nativeLib:(e,t)=>new Promise(((e,t)=>{}))},M=e=>B.createPdfLib(e),D=e=>new Promise(((t,n)=>{if(!e.options)return n(E.ITEM_OPTIONS_LOST);if(e.options.useBuffer)return n(E.PIC_GEN_THUMB_NOT_SUPPORT_BUFFER);let i=v({isOnline:e.isOnline||!1});const o=()=>{let s=i.shift();s.lib(e,s.deps).then((e=>{t(e)})).catch((e=>{if(i.length<=0)return n(e||E.PIC_GEN_THUMB_FAIL);o()}))};if(e.options.dimension)o();else{let t=e.options.clientId||e.options.thumbKey||Date.now();p.default.getDimension({url:e.url,path:e.localPath,key:t,checksum:e.options.checksum,buffer:e.options.metaBuffer||0,srcAction:7}).then((t=>{e.options.dimension=t,o()})).catch((e=>{n(E.PIC_THUMB_GEN_GET_DIMENSION_FAIL)}))}})),v=e=>{let t=[],n=U.createPicThumbLib(!0),i=U.createPicThumbLib(!1);const o=Object.keys(e);for(let s of o)"isOnline"==s&&(e[s]||t.push(n),t.push(i));return t},U={createPicThumbLib:function(e=!0){return e?{lib:this.nativeLib,deps:{FileUtils:P,decompress:y,nodeUtils:F,calculateOutputDimension:f.a.calculateOutputDimension}}:{lib:this.jsLib,deps:{FileUtils:P,reader:new FileReader,nodeUtils:F,writetoFileStream:f.a.writetoFileStream,validURL:f.a.validURL,calculateOutputDimension:f.a.calculateOutputDimension,orientationCaculator:f.a.orientationCaculator,calculateDrawDimension:f.a.calculateDrawDimension}}},jsLib:(e,t)=>new Promise(((n,i)=>{let{outputW:o,outputH:s}=t.calculateOutputDimension(e);if(!s||!o)return i(E.PIC_THUMB_RESIZE_DIMENSION_EMPTY);let{_outputW:a,_outputH:r}=t.calculateDrawDimension(e.options.dimension.orientation,{width:o,height:s});if(!e.options.savePath)return i(E.SAVE_PATH_EMPTY);let u=e.options.savePath,l=t.validURL(e.localPath)?e.localPath:"file://"+e.localPath,c=new Image;c.crossOrigin="Anonymous";let h=document.createElement("canvas");h.width=a,h.height=r;let p=h.getContext("2d");c.onload=()=>{t.orientationCaculator(e,h,p),p.drawImage(c,-o/2,-s/2,o,s),h.toBlob((e=>{t.reader.onload=()=>{let e=new Buffer(t.reader.result);t.writetoFileStream(u,e,(e=>{e?i(E.SAVE_THUMB_FILE_ERROR):n({savePath:u,tDimension:{width:o,height:s}})}))},t.reader.readAsArrayBuffer(e)}),"image/jpeg",1)},c.onerror=e=>{i(E.PIC_GEN_THUMB_JS_LOAD_IMAGE_ERROR)},c.src=l})),nativeLib:(e,t)=>new Promise(((n,i)=>{let{outputW:o,outputH:s}=t.calculateOutputDimension(e);if(!s||!o)return i(E.PIC_THUMB_RESIZE_DIMENSION_EMPTY);if(!e.options.savePath)return i(E.SAVE_PATH_EMPTY);let a=e.options.savePath;if(!e.options.tempPath)return i(E.SAVE_TEMP_PATH_EMPTY);let r=e.options.tempPath;F.zimage({decompress:y,rimraf:I}).then((t=>{const u=t.Image;let l;e.options.quality&&e.options.quality<=1&&e.options.quality>0?l*=100:l=80,u.resizeQA(e.localPath.replace(/(^\w+:|^)\/\/\//,""),r,o,s,l,!0,(e=>{e?i(E.PIC_GEN_THUMB_NATIVE_FAIL):r!=a?b.rename(r,a,(e=>{e?i(E.PIC_GEN_THUMB_NATIVE_RENAME_ERROR):n({savePath:a,tDimension:{width:o,height:s}})})):n({savePath:a,tDimension:{width:o,height:s}})}))})).catch((()=>{i(E.PIC_GEN_NATIVE_LIB_LOAD_FAIL)}))}))},A=e=>H.createTextThumbLib(e),H={createTextThumbLib:function(e){return this.jsLib(e,{getText:f.a.getText.bind(f.a)})},jsLib:(e,t)=>new Promise(((n,i)=>{let o=e.options.row||T.ROW,s=e.options.len||T.LEN;t.getText(e.localPath,{row:o,len:s}).then(n).catch(i)}))};var G=R;const{THUMB_ERR:k,GENERATOR_TYPE:x,THUMB_ACTION:j}=_.a;let q;q=n("Dprd").default;var K=class{constructor(e){this.item=e.item,this.timeOut=e.timeOut,this.updatePing=e.updatePing,this.getRunningSession=e.getRunningSession,this.setRunningSession=e.setRunningSession}genThumb(){return this.handleGenThumb(this.item)}handleGenThumb(e){return this._handleGenThumb.call(this,e,{FileUtils:q,getThumbCache:this.getThumbCache.bind(this),prepareFile:this.prepareFile.bind(this),createThumbGenerator:G.createThumbGenerator,getGenType:f.a.getGenType.bind(f.a),timeOut:this.timeOut,updatePing:this.updatePing,getSavePathFile:f.a.getSavePathFile.bind(f.a),updateLastAction:f.a.updateLastAction})}_handleGenThumb(e,t){return new Promise(((n,i)=>{t.timeOut(i,e.options.thumbKey),t.updateLastAction(e,j.THUMB_FILE.GET_THUMB_CACHE),t.getThumbCache(e).then((i=>{t.updateLastAction(e,j.THUMB_FILE.GEN_THUMB_DONE),n({savePath:i})})).catch((o=>{t.updateLastAction(e,j.THUMB_FILE.PREPARE_FILE_LOCAL),t.prepareFile(e,{prepareLocalFile:this.prepareLocalFile.bind(this),prepareOnlineFile:this.prepareOnlineFile.bind(this)}).then((o=>{if(!e.options.checksum&&o.checksum&&(e.options.checksum=o.checksum),e.options.ext||(e.options.ext=o.ext),e.options.savePath||(e.options.savePath=t.getSavePathFile(e)),e.options.tempPath||(e.options.tempPath=t.getSavePathFile(e,!0)),o.metaBuffer&&(e.options.metaBuffer=o.metaBuffer),o.useBuffer&&(e.options.useBuffer=o.useBuffer),this.getRunningSession(e.options.checksum))return i(k.THUMB_GEN_SESSION_KEY_DUPLICATE);this.setRunningSession(e.options.checksum),e.options.sessionKey=e.options.checksum,t.updateLastAction(e,j.THUMB_FILE.GET_THUMB_CACHE2),t.getThumbCache(e).then((i=>{t.updateLastAction(e,j.THUMB_FILE.GEN_THUMB_DONE),n({savePath:i})})).catch((s=>{t.updatePing();let a=f.a.getGenType(o.ext);if(a&&[x.PDF,x.OFFICE,x.PICTURE].includes(a)){let o=t.createThumbGenerator(a);t.updateLastAction(e,j.THUMB_FILE.GEN_THUMB),o(e).then((i=>{t.updateLastAction(e,j.THUMB_FILE.GEN_THUMB_DONE),n(i)})).catch((n=>{t.updateLastAction(e,j.THUMB_FILE.GEN_THUMB_DONE),i(n)}))}else i(k.THUMB_GEN_NOT_SUPPORT_TYPE)}))})).catch(i)}))}))}getThumbCache(e){return this._getThumbCache.call(this,e,{fileExistAsync:f.a.fileExistAsync,updatePing:this.updatePing,getCachePathsFile:f.a.getCachePathsFile.bind(f.a)})}_getThumbCache(e,t){return new Promise(((n,i)=>{if(t.updatePing(),e.options.byPassCache)return i(k.GET_THUMB_CACHE_BY_PASS);let o=t.getCachePathsFile(e.options);o.length>0?o.reduce(((e,n)=>e.catch((()=>t.fileExistAsync(n)))),Promise.reject()).then((e=>n(e))).catch((()=>i(k.GET_THUMB_CACHE_LOCAL_NOT_FOUND))):i(k.GET_THUMB_CACHE_LOCAL_NOT_FOUND)}))}prepareFile(e,t){return new Promise(((n,i)=>{t.prepareLocalFile(e).then((e=>{n(e)})).catch((e=>{i(e)}))}))}prepareLocalFile(e){return this._prepareLocalFile.call(this,e,{fileExist:f.a.fileExist.bind(f.a),getCacheLocalFile:f.a.getCacheLocalFile.bind(f.a),fileType:f.a.fileType.bind(f.a),fileTypeBuffer:f.a.fileTypeBuffer.bind(f.a),fileChecksum:f.a.fileChecksum.bind(f.a),fileChecksumBuffer:f.a.fileChecksumBuffer.bind(f.a),handleAutoDownloadCacheLocalFile:f.a.handleAutoDownloadCacheLocalFile,updatePing:this.updatePing})}_prepareLocalFile(e,t){return new Promise(((n,i)=>{t.updatePing(),t.fileExist(e.localPath)?this.__prepareLocalFile.call(this,e,{fileType:t.fileType,fileChecksum:t.fileChecksum,fileTypeBuffer:t.fileTypeBuffer,fileChecksumBuffer:t.fileChecksumBuffer}).then((e=>{n(e)})).catch((e=>{i(e)})):t.getCacheLocalFile(e.options).then((o=>{o&&o.useBuffer?(e.fBuffer=o.fBuffer,e.options.useBuffer=!0):e.localPath=o.cachePath,this.__prepareLocalFile.call(this,e,{fileType:t.fileType,fileChecksum:t.fileChecksum,fileTypeBuffer:t.fileTypeBuffer,fileChecksumBuffer:t.fileChecksumBuffer}).then((e=>{n(Object(d.a)(Object(d.a)({},o),e))})).catch((e=>{i(e)}))})).catch((e=>{i(e)}))}))}__prepareLocalFile(e,t){return e&&e.options.useBuffer?this.__prepareLocalFileBuffer.call(this,e,{fileTypeBuffer:t.fileTypeBuffer,fileChecksumBuffer:t.fileChecksumBuffer}):this.__prepareLocalFileLocal.call(this,e,{fileType:t.fileType,fileChecksum:t.fileChecksum})}__prepareLocalFileBuffer(e,t){return new Promise(((n,i)=>{t.fileTypeBuffer(e.fBuffer).then((o=>{e.options.checksum?n(Object(d.a)({},o)):t.fileChecksumBuffer(e.fBuffer).then((e=>{n(Object(d.a)(Object(d.a)({},o),{},{checksum:e}))})).catch((()=>{i(k.GET_FILE_CHECKSUM_ERROR)}))})).catch((()=>{i(k.GET_FILE_TYPE_ERROR)}))}))}__prepareLocalFileLocal(e,t){return new Promise(((n,i)=>{t.fileType(e.localPath).then((o=>{e.options.checksum?n(Object(d.a)({},o)):t.fileChecksum(e.localPath).then((e=>{n(Object(d.a)(Object(d.a)({},o),{},{checksum:e}))})).catch((()=>{i(k.GET_FILE_CHECKSUM_ERROR)}))})).catch((()=>{i(k.GET_FILE_TYPE_ERROR)}))}))}prepareOnlineFile(e){return this._prepareOnlineFile.call(this,e,{fileTypeOnl:f.a.fileTypeOnl.bind(f.a),updatePing:this.updatePing,isSupportOnlineThumb:f.a.isSupportOnlineThumb})}_prepareOnlineFile(e,t){return new Promise(((n,i)=>(t.updatePing(),e.url?e.options.checksum?void t.fileTypeOnl(e.url).then((e=>{t.isSupportOnlineThumb(e.ext)?n(Object(d.a)(Object(d.a)({},e),{},{isOnline:!0})):i(k.NOT_SUPPORT_ONL_THUMB)})).catch((e=>{i(e)})):i(k.GET_ONLINE_FILE_INFOS_NO_CHECKSUM):i(k.GET_ONLINE_FILE_INFOS_URL_NOT_FOUND))))}},W=n("sg3c"),z=n("1pet"),Y=n("jDHv"),Q=n("Mgpg"),V=n("qlGb");const{THUMB_ERR:J,THUMB_CHANNEL:Z,PIC_THUMB:X,MAX_CONCURRENT:$,THUMB_DOWNLOAD_RESP_CHANNEL:ee}=_.a;let te;te=n("NLsH").ipcRenderer;const ne=new Set(["folder"]),ie=new Set(["photo-chat","photo-media","file-chat","file-photo"]);var oe=new class{constructor(){this.queue=[],this.running=new Map,this.doneSession={},this.pingSession={},this.timeOutSession={},this.runningSession={},this.subQueue=[],this.subRunning=new Map,this.pendingQueue=[],this.autoDownloadQueue=new Map,this.autoDownload404Map={},this.Logger=Y.ModuleContainer.resolve(Q.ZLoggerFactory).createZLogger("utils",["thumb","thumb-generator"])}add(e){this._add(e)}_add(e){e.options&&"object"==typeof e.options?(e.options.pPoints||(e.options.pPoints=0),e.options.pCoefficient||(e.options.pCoefficient=0),this.__add(e),this._run()):(this.onDone(J.ITEM_OPTIONS_LOST,null,e),f.a.logQos(J.ITEM_OPTIONS_LOST,!0,h.a.now()))}__add(e){let t=e.options.type;switch(t||(t="file-chat"),t){case ne.has(t):this.subQueue.push(e);break;case ie.has(t):default:this.queue.push(e)}}sortPriority(e){e.sort(((e,t)=>e.options.pPoints*e.options.pCoefficient<t.options.pPoints*t.options.pCoefficient?1:-1))}handleDuplicateThumbKey(e,t,n){switch(e.options.type){case"photo-chat":case"photo-media":let i=e.options.thumbKey,o=e.options.thumbSize,s=n.get(i);if(s&&s.options.thumbSize===o)return!0;if(-1!=t.findIndex((t=>t.options.thumbKey===e.options.thumbKey&&e.options.thumbSize===t.options.thumbSize)))return!0;break;default:if(n.has(e.options.thumbKey))return!0;if(-1!=t.findIndex((t=>t.options.thumbKey===e.options.thumbKey)))return!0}return!1}handleRemoveRunningSession(e,t){e&&e.name==J.THUMB_GEN_SESSION_KEY_DUPLICATE.name||!t||this.removeRunningSession(t)}removeRunningSession(e){delete this.runningSession[e]}setRunningSession(e){this.runningSession[e]=!0}getRunningSession(e){return!!this.runningSession[e]}handleAutoDownload(e){var t;let{url:n,msgId:i}=V.getDataFromMessage(null==e||null===(t=e.options)||void 0===t?void 0:t.message);if(n&&i&&!this.autoDownloadQueue.has(i)&&(Number.isNaN(this.autoDownload404Map[n])||!(this.autoDownload404Map[n]>1)))switch(e.options.pPoints=0,e.options.pCoefficient=0,e.options.autoDownloaded=!0,this.autoDownloadQueue.set(i,e),e.options.type){case"photo-chat":case"photo-media":f.a.handleAutoDownloadCacheLocalPhoto(e).then((t=>{this.add(e),this.autoDownloadQueue.delete(i),this.autoDownload404Map[n]&&delete this.autoDownload404Map[n]})).catch((e=>{this.autoDownloadQueue.delete(i),"string"==typeof(null==e?void 0:e.name)&&e.name.includes("404")&&(Number.isNaN(this.autoDownload404Map[n])?this.autoDownload404Map[n]=0:this.autoDownload404Map[n]+=1)}));break;default:f.a.handleAutoDownloadCacheLocalFile(e).then((t=>{this.add(e),this.autoDownloadQueue.delete(i),this.autoDownload404Map[n]&&delete this.autoDownload404Map[n]})).catch((e=>{this.autoDownloadQueue.delete(i),"string"==typeof(null==e?void 0:e.name)&&e.name.includes("404")&&(Number.isNaN(this.autoDownload404Map[n])?this.autoDownload404Map[n]=0:this.autoDownload404Map[n]+=1)}))}}setRaf(e=!1){f.a.setRaf(e)}updatePing(){const e=Object.keys(this.pingSession);for(const t of e)this.pingSession[t]=h.a.now()}timeOut(e,t){let n=()=>{h.a.now()-this.pingSession[t]>2e4?(this.clearTimeOut(t),e(J.EXECUTION_TIME_OUT_BACKGROUND)):this.timeOutSession[t]=setTimeout(n.bind(this),3e3)};this.timeOutSession[t]=setTimeout(n.bind(this),18e3)}clearTimeOut(e){clearTimeout(this.timeOutSession[e]),this.timeOutSession[e]=null,delete this.timeOutSession[e]}thumbBuilderSelector(e){let t;return e.options.type,t=new K({item:e,timeOut:this.timeOut.bind(this),updatePing:this.updatePing.bind(this),getRunningSession:this.getRunningSession.bind(this),setRunningSession:this.setRunningSession.bind(this)}),t}_getJob(){return this.queue.length>0?(this.sortPriority(this.queue),this.queue.splice(0,1)[0]):this.subQueue.length>0?this.subQueue.splice(0,1)[0]:{}}_hasJob(){return this.queue.length>0||this.subQueue.length>0}_run(){if(this.isRunning)return;let e=$-this.running.size;if(e>0){this.isRunning=!0;for(let t=0;t<e;t++){let n=this._getJob();if(n&&Object.getOwnPropertyNames(n).length>0){this.running.set(n.options.thumbKey,n);let e=h.a.now();this.pingSession[n.options.thumbKey]=e,setTimeout((()=>{this.thumbBuilderSelector(n).genThumb().then((t=>{this.onDone(null,t,n),this.afterOnDone({success:!0,errro:null,startTime:e},n)})).catch((t=>{this.Logger.zsymb(16,8252,3e4,"[ThumbManager][BackGround][Fail]",t,Date.now()-e,n.options.thumbKey),this.onDone(t,null,n),this.afterOnDone({success:!1,error:t,startTime:e},n)}))}),250)}if(!(t-(e-1)<0))break}this.isRunning=!1}}afterOnDone(e,t){let n=t.options&&t.options.type?t.options.type:"",i=e.startTime||h.a.now();if(e.success){if(n)return void f.a.logQos(null,!0,i,91051);f.a.logQos(null,!0,i)}else if(e.error){if(e.error.name==J.EXECUTION_TIME_OUT_BACKGROUND.name&&(e.error.byPassCode=t.options&&t.options.ext?10*e.error.code+f.a.getGenType(t.options.ext):1110,this.Logger.zsymb(16,8252,30001,"[ThumbManager][Fail] TimeOut BackGround, last action: {}, code: {}",t.options.lastAction,e.error.byPassCode)),n)return void f.a.logQos(e.error,!1,i,91051);f.a.logQos(e.error,!1,i),e.error.name==J.GET_LOCAL_CACHE_FILE_NOT_FOUND.name&&t.options&&!t.options.autoDownloaded&&this.handleAutoDownload(t)}}onDone(e,t,n){this.clearTimeOut(n.options.thumbKey),this.handleRemoveRunningSession(e,n.options.sessionKey),this.running&&this.running.delete(n.options.thumbKey),this.pingSession[n.options.thumbKey]&&delete this.pingSession[n.options.thumbKey],this.doneSession[n.options.thumbKey]||(this.doneSession[n.thumbKey]=!0,te.send(Z.GEN_THUMB_RESULT,{error:e,text:t?t.text:"",savePath:t?t.savePath:"",thumbKey:n.options.thumbKey,totalTime:n.totalTime,tDimension:t?t.tDimension:"",checksum:n.options.checksum,clientId:n.options.clientId,dimension:X.includes(n.options.ext)?n.options.dimension||p.default.getDimensionSync(n.options.metaBuffer):null,type:n.options.type,toUid:n.options.message?n.options.message.toUid:"",isE2ee:Object(W.f)(n.options.message)===z.MSG_E2EE}),$-this.running.size>0&&this._hasJob()&&this._run())}},se=n("p4w/"),ae=n("Ydol"),re=n("ia0/"),ue=n("xrk1"),le=n("igA5"),ce=n("9Ht6");const he=["session"],pe=n("NLsH"),fe=pe.ipcRenderer;n("xXR1").default();n("8JxD"),function(){try{let e=new Image;e.onerror=e=>{},e.onload=()=>{},e.src=l.default.emojiImg}catch(Pe){}}();const de=Y.ModuleContainer.resolve(Q.ZLoggerFactory).createZLogger("pc",["photo"]);function _e(e,t){fe.send("view-original-message",{msgId:e,conversation:t})}let me,ge=()=>{},Ee=function(){const[e,t]=a.a.useState({});a.a.useEffect((()=>(me=t,()=>me=null)),[]);const{data:n,sessionId:i}=e;return a.a.createElement(c.a,Object(o.a)({key:"photo-viewer-zalo"},n,{viewOriginalMessage:_e,dispatch:ge,sessionId:i}))};Ee=a.a.memo(Ee);const Te=document.getElementById("photoViewer");u.a.render(a.a.createElement(ue.d,{key:"redux-provider"},a.a.createElement(ce.RecoilRoot,null,a.a.createElement(Ee,null))),Te),pe.webFrame.setVisualZoomLevelLimits(1,1),fe.on("view-data",((e,t,n)=>{var o,s;de.zsymb(3,10633,3e4,"do action: view data");const a=null!=(o=t)?o:{},{session:r}=a,u=Object(i.a)(a,he);if(r){le.a.getInstance().init(r.userId,r.UIN)}t=u,null===(s=me)||void 0===s||s({data:t,sessionId:n}),fe.send("view-data-received",t._ack)})),fe.on("ping-process",((e,t)=>{de.zsymb(5,10633,30001,"received ping ",t),fe.send(`ping-process-ack-${t}`)})),fe.on("thumb-channel",((e,t)=>{de.zsymb(3,10633,30002,"do action: thumb channel"),se.a.onChannel(t)})),fe.on("send-event-bus",((e,t)=>{de.zsymb(3,10633,30003,"do action: send-event-bus"),ae.default.send(t.type,t.payload)})),fe.on("set-raf",((e,t)=>{oe.setRaf(t)})),window.onerror=e=>{de.zsymb(18,10633,30004,e)},de.zsymb(3,10633,30005,"pid photoviewer",process.pid),fe.send("zmain_register_process","photoview",process.pid),fe.on("record-cpu-photoview",((e,t,n)=>{de.zsymb(3,10633,30006,"do action: cpu"),re.a.recordingRenderer(t).then((e=>{fe.send("resp-record-cpu-photoview",e,n)})).catch((e=>{fe.send("resp-record-cpu-photoview",null,n)}))}));var be=n("wH4e"),Oe=n("+eUS");n("ycwz");Object(Oe.a)(be.RunMode.Client)},tW87:function(e,t){e.exports=require("original-fs")},tlh6:function(e,t){e.exports=require("string_decoder")},ugmf:function(e,t){e.exports=require("tls")}});
//# sourceMappingURL=sourcemaps/photo.1c41c23311c8b15682aa.js.map