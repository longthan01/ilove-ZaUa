!function(e){function t(t){for(var n,i,s=t[0],l=t[1],c=t[2],u=0,f=[];u<s.length;u++)i=s[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(d&&d(t);f.length;)f.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,i=1;i<a.length;i++){var l=a[i];0!==r[l]&&(n=!1)}n&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var n={},i={32:0},r={32:0},o=[];function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.e=function(e){var t=[];i[e]?t.push(i[e]):0!==i[e]&&{38:1,39:1,40:1}[e]&&t.push(i[e]=new Promise((function(t,a){for(var n=({7:"countries",16:"lang-en",17:"lang-vi"}[e]||e)+".1c41c23311c8b15682aa.css",r=s.p+n,o=document.getElementsByTagName("link"),l=0;l<o.length;l++){var c=(d=o[l]).getAttribute("data-href")||d.getAttribute("href");if("stylesheet"===d.rel&&(c===n||c===r))return t()}var u=document.getElementsByTagName("style");for(l=0;l<u.length;l++){var d;if((c=(d=u[l]).getAttribute("data-href"))===n||c===r)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var n=t&&t.target&&t.target.src||r,o=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=n,delete i[e],f.parentNode.removeChild(f),a(o)},f.href=r,document.getElementsByTagName("head")[0].appendChild(f)})).then((function(){i[e]=0})));var a=r[e];if(0!==a)if(a)t.push(a[2]);else{var n=new Promise((function(t,n){a=r[e]=[t,n]}));t.push(a[2]=n);var o,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=function(e){return s.p+"lazy/"+({7:"countries",16:"lang-en",17:"lang-vi"}[e]||e)+"."+{7:"f3154653b05be0ae842e",16:"b5f2f7c446df81f918ad",17:"c18e31f25a079898d6ac",35:"c9caca38b90da9f3e280",36:"6eb555b501a69498ab63",37:"c5e940a22d3b4b27100a",38:"ee9965cdefe5234346af",39:"28ea051c980c2bb3673d",40:"aeeb1b90de034ceceae1",41:"ed020c7dde7db1e7a63d",42:"4279ee5095da4aa3492e",43:"f6ab9df9fce6c73995a6"}[e]+".js"}(e);var c=new Error;o=function(t){l.onerror=l.onload=null,clearTimeout(u);var a=r[e];if(0!==a){if(a){var n=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+n+": "+i+")",c.name="ChunkLoadError",c.type=n,c.request=i,a[1](c)}r[e]=void 0}};var u=setTimeout((function(){o({type:"timeout",target:l})}),12e4);l.onerror=l.onload=o,document.head.appendChild(l)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw e};var l=this.webpackJsonp=this.webpackJsonp||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var d=c;o.push([2,0,4,3,2,1]),a()}({"/0p4":function(e,t){e.exports=require("events")},"14cR":function(e,t){e.exports=require("punycode")},2:function(e,t,a){e.exports=a("eDZm")},"7WL4":function(e,t){e.exports=require("https")},"8xkj":function(e,t){e.exports=require("querystring")},CgVK:function(e,t){e.exports=require("constants")},EXGp:function(e,t){e.exports=require("..\\native\\nativelibs")},FMKJ:function(e,t){e.exports=require("zlib")},KEll:function(e,t){e.exports=require("http")},NLsH:function(e,t){e.exports=require("electron")},NkYg:function(e,t){e.exports=require("buffer")},PJMN:function(e,t){e.exports=require("crypto")},QduZ:function(e,t){e.exports=require("child_process")},Qs2e:function(e,t){e.exports=require("net")},Qs3B:function(e,t){e.exports=require("assert")},bzos:function(e,t){e.exports=require("url")},eDZm:function(e,t,a){"use strict";a.r(t);a("zVm2");var n=a("NLsH"),i=a("MxEi"),r=a("VTBJ"),o=a("z0WU"),s=a("jDHv"),l=a("MnS2");var c=class{constructor(e,t=3,a=2e3,n={r:57,g:70,b:78,a:1}){if(this.canvas=e,!e)return void o.default.logCoreError("canvas is undefined!!");this.x=e.width/2,this.y=e.height/2,this.context=e.getContext("2d"),this.active=!1,this.color=n,this.listRadius=[],this.list=[],this.mxRadius=Math.min(e.width,e.height)/2;let i=Math.round(this.mxRadius/t);this.step=this.mxRadius/100;for(let r=0;r<t;r++)this.listRadius.push(-r*i)}get requestAnimationFrame(){if(!this._requestAnimationFrame){const{requestAnimationFrame:e}=s.ModuleContainer.resolve(l.rAF);this._requestAnimationFrame=e}return this._requestAnimationFrame}getColor(e){return`rgba(${e.r},${e.g},${e.r},${e.a})`}start(){this.active=!0,this.list=[...this.listRadius],this.startTime=Date.now(),this.render(),setTimeout((()=>{this.active=!1}),12e4)}stop(){this.active=!1}drawLast(){let e=this.context,t=[];this.canvas;t=[50,40,30],t.forEach((t=>{if(t<=0)return;let a=Object(r.a)(Object(r.a)({},this.color),{},{a:this.color.a*(1-t/this.mxRadius)});e.fillStyle=this.getColor(a),e.beginPath(),e.arc(this.x,this.y,t,0,2*Math.PI,!1),e.closePath(),e.fill()}))}updateSize(){}getScale(){let e=this.canvas.clientWidth||0;return Math.max(1,Math.round(e/400))}render(){let e=this.context,t=this.list,a=this.canvas;if(this.updateSize(),e.clearRect(0,0,a.width,a.height),!this.active)return;t.sort(((e,t)=>t-e)),t.forEach((t=>{if(t<=0)return;let a=Object(r.a)(Object(r.a)({},this.color),{},{a:this.color.a*(1-t/this.mxRadius)});e.fillStyle=this.getColor(a),e.beginPath(),e.arc(this.x,this.y,t,0,2*Math.PI,!1),e.closePath(),e.fill()}));let n=Date.now(),i=(n-this.startTime)/100;this.startTime=n,t=t.map((e=>e+this.step*i)),this.list=t.filter((e=>e<this.mxRadius)),this.list.length>0?(this.step*=1.01,requestAnimationFrame(this.render.bind(this))):(e.clearRect(0,0,a.width,a.height),this.list=[...this.listRadius],this.step=this.mxRadius/100,setTimeout(this.render.bind(this),this.timeoutStep))}},u=a("q1tI"),d=a.n(u),f=(a("17x9"),a("i8i4")),p=a.n(f),h=a("pg6P"),m=a("lCMA");class _ extends d.a.Component{constructor(e){super(e),this._cancel=this._cancel.bind(this),this._save=this._save.bind(this),this.state={active:e.active}}componentWillReceiveProps(e){e.active&&this.setState({active:e.active})}shouldComponentUpdate(e,t){return this.state.active!=t.active}_cancel(){this.setState({active:!1})}_save(){this._setting&&(this._setting.saveAllSettings(),this.props.realTimeSet&&this.props.realTimeSet(this._setting.getAllDeviceSettings())),this._cancel()}render(){return this.state.active?d.a.createElement("div",{className:"modal animated fadeIn",onMouseDown:this._pageClick,ref:e=>this._dom=e},d.a.createElement("div",{className:"modal-container flx-cell flx flx-center flx-al-c ovf-hidden"},d.a.createElement("div",{className:"modal-dialog animated zoomIn",style:{width:"458px"}},d.a.createElement("div",{className:"modal-dialog-title flx flx-sp-btw"},d.a.createElement(m.a,{tagName:"span",textKey:"STR_VIDEO_CALL_SETTINGS"}),d.a.createElement("span",{onClick:this._cancel,className:"modal-close"},d.a.createElement("i",{className:"fa fa-close"}))),d.a.createElement("div",{className:"modal-dialog-body no-padding",onClick:this.props.onClick},d.a.createElement(h.default,{ref:e=>this._setting=e,userId:this.props.userId,preventAutoSave:!0}),d.a.createElement("div",{className:"call-setting"},d.a.createElement("div",{className:"call-setting-btn btn btn-txt",onClick:this._cancel},"Cancel"),d.a.createElement("div",{className:"call-setting-btn btn btn-txt btn-primary",onClick:this._save},"Save")))))):null}}var v=_,g=a("1pet"),b=a("Enw1");window.onerror=e=>{n.ipcRenderer.send(i.d,e)};const y=!1;var x,N=!1;try{x=a("EXGp").zcall(),N=x.test()}catch(qe){}N||n.ipcRenderer.send(i.d,"LOAD_LIB_FAIL");var k,E,C,A,w,I,T,L,S,O,R,D,M,q,z,P,j,G=!1,V=!1,$=!1,H=!1,U=!1,F=!1,B=!1,J=!1,W=!1,K=!1,Q=!1,Z=null,X=!1,Y=!1;const ee="CALLING",te="RING_RING",ae="INCALL",ne="START",ie="END",re="INCOMINGCALL";var oe={offCamera:"đã tắt camera",calling:"đang gọi",ringring:"đang đổ chuông",network:"Đường truyền",veryGoodNetwork:"rất tốt",goodNetwork:"tốt",poorNetwork:"kém",holdAudioText:"Đang trong cuộc gọi khác"};const se={_audio:null,notiOutgoing:function(){this.stop(),this._audio=new Audio,this._audio.loop=!0,this._audio.oncanplay=()=>{this._audio&&this._audio.play()},this._audio.src="assets/zalo_ringback.87344ec19690e822db9cbdc8b872488c.mp3"},notiIncoming:function(){this.stop(),this._audio=new Audio,this._audio.loop=!0,this._audio.oncanplay=()=>{this._audio&&this._audio.play()},this._audio.src="assets/zalo_ringtone.fc8a0b0f0f6b79ec569af453c1a76e11.mp3"},stop:function(){this._audio&&(this._audio.pause(),this._audio=null)}};function le(e){return document.getElementById(e)}function ce(){H=!1,function(){if(R)return R;let e={},t=window.location.search;if(t){let a=t.substr(1).split("&");for(let t=0;t<a.length;t++){let n=a[t].split("=");e[n[0]]="true"==decodeURIComponent(n[1])}}R=e}(),z=le("minimize-video-call"),P=le("full-video-call"),j=le("container_canvas_local"),R.video?(Te(P," full-voice",!1),Te(P," full-video",!0)):(Te(P," full-video",!1),Te(P," full-voice",!0)),R.caller?(z.style.display="none",P.style.display="block"):(z.style.display="block",P.style.display="none",R.video?(Te(z," voice",!1),Te(z," video",!0)):(Te(z," video",!1),Te(z," voice",!0))),le("minimize-video-call_btn-accept").onclick=Ie,le("minimize-video-call_btn-accept-video").onclick=Ie,le("minimize-video-call_btn-cancel").onclick=De,le("btn_video_end").onclick=Me,le("btn_video_stop_capture").onclick=Re,le("btn_video_mute").onclick=Le,le("btn_video_minimize_local").onclick=ue,le("btn_video_maximize_local").onclick=de,le("btn_device_settings").onclick=pe,A=new c(le("partner_avatar_animation"),3,700,{r:255,g:255,b:255,a:.7}),I=le("call_time_info"),le("call_network_info"),T=le("call_status_info"),D=le("btn_video_stop_capture"),M=le("btn_video_mute"),b.g.getGeneralFlag("language",g.LANG_INDEX_VI)!=g.LANG_INDEX_VI&&(oe={offCamera:"turned off the camera",calling:"calling..",ringring:"Ringing...",network:"Quality ",veryGoodNetwork:"Excellent",goodNetwork:"Good",poorNetwork:"Poor",holdAudioText:"In another call"},Te(le("minimize-video-call")," en",!0),_e(5)),ve(ne),x.bindCallbackEventMessage(Ce),n.ipcRenderer.send(i.f),L=!1,Ee()}function ue(){le("btn_video_minimize_local").style.display="none",le("btn_video_maximize_local").style.display="block",j.style.display="none"}function de(){le("btn_video_maximize_local").style.display="none",le("btn_video_minimize_local").style.display="block",j.style.display="block"}function fe(e){switch(e.act){case"answer":if(0!=e.data.status)ye();else if(e.data.params){let t=JSON.parse(e.data.params);if(Q){let e=!1;if(t.extendData){let a=t.extendData;try{a=JSON.parse(a),a&&1==a.callType&&(e=!0),a&&1==a.platform&&x.changeMinMaxMobileBitrate()}catch(qe){}}e||(Q=!1,Te(P," full-video",!1),Te(P," full-voice",!0))}x.updateCallerInfo(t.codec,t.extendData)}break;case"answer_ack":(F||$)&&(0!=e.data.status?ye():(S=Date.now(),H=!0,setTimeout((()=>{U=!0}),1e3),ve(ae)));break;case"ring_ring":0!=e.data.status?ye():ve(te);break;case"end_call":case"cancel":ye();break;case"hold_request":Y=!0,I&&(I.innerHTML=oe.holdAudioText),x.holdAudio(!0,!1);break;case"unhold_request":Y=!1,x.holdAudio(!1,!1)}}function pe(){let e=le("setting-popup");e&&Z&&p.a.render(d.a.createElement(v,{active:!0,realTimeSet:he,userId:Z}),e)}function he(e){if(!e||e.constructor!=Object)return;const t=(e,t)=>null!=e?e:t;null==e.audioInput&&null==e.audioOutput||x.changeAudioDevice(t(e.audioInput,-10),t(e.audioOutput,-10)),null==e.audioInputVolume&&null==e.audioOutputVolume||x.setAudioVolume(t(e.audioInputVolume,200),t(e.audioOutputVolume,200)),e.videoInput&&x.changeVideoDevice(e.videoInput),w&&(w=null)}function me(e){if(e)if(e.success){let t=i.j;switch(e.type){case t.REQUEST_CALL:K=!0,F=!0,Z=e.myUserId,e.deviceSettings&&(w=e.deviceSettings),Q=e.isVideoCall,ge(e.partnerData),ve(ee),Q&&we(),x.makeCall(e.data,e.isVideoCall).then((e=>{})).catch((e=>{K=!1}));break;case t.SEND_REQUEST:break;case t.RECEIVE_CALL:X=e.noDevice,Q=e.isVideoCall,W=!!e.noCamera,K=!0,F=!1,e.deviceSettings&&(w=e.deviceSettings),Z=e.myUserId,ge(e.partnerData),ve(re),Q&&we(),E=e;break;case t.SEND_ANSWER_ACK:H=!0,setTimeout((()=>{U=!0}),1e3),S=Date.now(),ve(ae);break;default:fe(e.data)}}else ye()}function _e(e){try{e=parseInt(e)}catch(qe){return!1}let t="";switch(e){case 5:t=Q?"assets/videocall_signal_strong.0bea8e69d01b6a7bcda4d0631ce96542.svg":`<span style="padding-left: 5px;color:#19d721">${oe.veryGoodNetwork}</span>`;break;case 4:t=Q?"assets/videocall_signal_normal.4c9e0a4e003bc75e6bb1d5d1df8ac842.svg":`<span style="padding-left: 5px;color:#19d721">${oe.goodNetwork}</span>`;break;case 3:case 2:case 1:t=Q?"assets/videocall_signal_bad.3d7a8b9073b8b7547cde86f5afa5aeda.svg":`<span style="padding-left: 5px;color:#e43731">${oe.poorNetwork}</span>`;break;default:return}Q?le("call_network_info").style.backgroundImage=`url(${t})`:le("call_network_info_voice").innerHTML=`${oe.network}: ${t}`}function ve(e){const t=()=>{q&&clearTimeout(q),q=setTimeout(Me,45e3)};switch(e){case ee:t(),A.start(),T.innerText=oe.calling,Te(P," full-calling",!0);break;case te:if(O!==ee)return;V=!0,se.notiOutgoing(),T.innerText=oe.ringring;break;case ae:F||function(){z.style.display="none",P.style.display="block";let e=k.getCurrentWindow();e.setSize(600,800,!0),e.setResizable(!0),e.setMaximizable(!0),e.center(),W&&Se(!0)}(),q&&clearTimeout(q),A.stop(),se.stop(),w&&he(w),W||!Q?Te(M," disable_btn",!1):(Te(M," disable_btn",!1),Te(D," disable_btn",!1)),Te(P," full-calling",!1),Te(P," full-incall",!0),n.ipcRenderer&&n.ipcRenderer.send("READY_IN_CALL",S),ke=!1;break;case re:t(),se.notiIncoming()}O=e}function ge(e){e,le("partner_avatar").style.backgroundImage=`url(${e.avatar})`,-1!=e.avatar.indexOf("default")||Q||(le("canvas_bg").style.backgroundImage=`url(${e.avatar})`),le("partner_name").innerText=e.name,F||(le("minimize-video-call_name").innerText=e.name,le("minimize-video-call_avatar").style.backgroundImage=`url(${e.avatar})`),Q&&(le("avatar_stop_remote").style.backgroundImage=`url(${e.avatar})`,le("txt_stop_remote").innerText=`${e.name} ${oe.offCamera}`)}function be(e=!1,t=!1){ve(ie),K=!1,H=!1,L=!0,setTimeout((()=>{n.ipcRenderer&&n.ipcRenderer.send(i.h,{isCancel:e,duration:0,statusEnd:null,json406:null,clickAccept:t})}),0)}function ye(e=!1){if(X)return be(e);let t=S?Date.now()-S:null,a=null,r=null;try{let n=x.getCallInfo();n=JSON.parse(n),null!=n.duration&&(t=1e3*n.duration),null!=n.qualityOverall&&(a=function(e,t){if(null==e)return null;if(isNaN(e))return null;if(e=parseInt(e),F&&O!=ae)return t?V?104:103:e;{let t=10*e;return t=G?t+1:t,t}}(n.qualityOverall,e))}catch(qe){}try{r=x.getJsonStats406()}catch(qe){}ve(ie),K=!1,H=!1,L=!0,x&&x.stop(),setTimeout((()=>{n.ipcRenderer&&n.ipcRenderer.send(i.h,{isCancel:e,duration:t,statusEnd:a,json406:r})}),0)}var xe;let Ne=Date.now(),ke=!0;function Ee(){if(!L){if(ke||Date.now()-Ne>=1e3){let e=k.getGlobal("callEvents").pop();e&&me(e),Ne=Date.now()}x&&(x.checkEventMessage(),H&&(Q&&U&&x.render(),function(){if(Y)return;if(xe&&Date.now()-xe<1e3)return;let e=(xe=Date.now())-S,t=Math.floor(e/1e3),a=Math.floor(t/60),n=t%60,i=Math.floor(a/60);a%=60,a=a<10?"0"+a:""+a,n=n<10?"0"+n:""+n;let r=a+":"+n;i>0&&(r=(i<10?"0"+i:""+i)+":"+r),I.innerHTML=r}())),setTimeout(Ee,1e3/30)}}function Ce(e){let t=i.i;switch(e.type){case t.ON_INIT_ZRTP_WITH_SERVER:e.codec=x.getActiveAudioCodecs().trim(),Q&&(e.extendData=x.getExtendData().trim()),n.ipcRenderer.send(t.CHANNEL_NAME,e);break;case t.ON_CALL_AUTO_HANGUP:G=!0,ye(!0);break;case t.ON_CALL_QUALITY_CHANGE:_e(e.quality);break;case t.ON_VIDEO_CALL_STATE:switch(parseInt(e.state)){case 8:case 10:Oe(!0);break;case 9:case 11:Oe(!1)}break;case t.ON_INCOMING_CALL:n.ipcRenderer.send(t.CHANNEL_NAME,e),function(){if(!C||!K)return;C=!1;let e=x.getActiveAudioCodecs().trim();let t=i.i,a={type:t.ON_ANSWER_CALL,codec:e};Q&&(a.extendData=x.getExtendData().trim());n.ipcRenderer.send(t.CHANNEL_NAME,a)}();break;case t.ON_INIT_ZRTP_REQUEST_FAILED:n.ipcRenderer.send(t.CHANNEL_NAME,e);break;case t.ON_LOG_DEBUG:n.ipcRenderer.send(t.ON_LOG_DEBUG,e)}}function Ae(e){let t=le(e);return[t.clientWidth,t.clientHeight,1]}function we(){let e=function(){let e=document.createElement("canvas"),t=null;return t=e.getContext("webgl")||e.getContext("experimental-webgl"),!!t}();x.bindCanvas(le("canvas_local"),le("canvas_remote"),!e,Ae.bind(this,"container_canvas_local"),Ae.bind(this,"container_canvas_remote"))}function Ie(){E&&(C||(X?be(!1,!0):(C=!0,E.isVideoCall,x.incomingCall(E.data,E.isVideoCall).then((e=>{$=!0,E&&E.data&&E.data.extendData&&function(e){if(e)try{let t=JSON.parse(e);t&&1==t.platform&&x.changeMinMaxMobileBitrate()}catch(t){}}(E.data.extendData)})).catch((e=>{K=!1})))))}function Te(e,t,a){let n=e.className;e.className=a?n.replace(t,"")+t:n.replace(t,"")}function Le(){O==ae&&(Te(M," btn-active",B=!B),x.mute(B))}function Se(e){if(J=e){let e=le("icon_stop_local"),i=le("canvas_local");t=i,n=["top","left","width","height"],(a=e).style.display="flex",n.forEach((e=>{a.style[e]=t.style[e]}))}else le("icon_stop_local").style.display="none";var t,a,n;Te(D," btn-active",J),x.stopCapture(J)}function Oe(e){le("icon_stop_remote").style.display=e?"flex":"none"}function Re(e){O==ae&&Q&&!W&&Se(!J)}function De(){ye(!0)}function Me(){ye(O!=ae)}document.addEventListener("DOMContentLoaded",(()=>{N&&ce()}))},jK02:function(e,t){e.exports=require("util")},"jle/":function(e,t){e.exports=require("os")},msIP:function(e,t){e.exports=require("stream")},"mw/K":function(e,t){e.exports=require("fs")},oyvS:function(e,t){e.exports=require("path")},tW87:function(e,t){e.exports=require("original-fs")},tlh6:function(e,t){e.exports=require("string_decoder")},ugmf:function(e,t){e.exports=require("tls")},zVm2:function(e,t,a){}});
//# sourceMappingURL=sourcemaps/videocall.1c41c23311c8b15682aa.js.map