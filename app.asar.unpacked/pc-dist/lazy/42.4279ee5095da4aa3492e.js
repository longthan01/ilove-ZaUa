(this.webpackJsonp=this.webpackJsonp||[]).push([[42],{"w5y+":function(t,e,s){"use strict";s.r(e);var i=s("EYv5"),r=s("jDHv"),o=s("8/YW"),n=s("/0p4"),a=s("Gm1y"),h=s("bdot"),l=s("yzMR"),c=s("VTBJ"),g=s("rePB"),u=s("kcif"),d=s.n(u),m=s("NDmK"),f=s("Yi2m"),p=s("z0WU"),y=s("KkZn");function v(t,e){const s=new Date(t),i=new Date(e).getTime()-s.getTime();return Math.round(i/864e5)}async function b(t,e,s=16){const i=async()=>{0!=t.length&&(await e(t.pop()),await new Promise((t=>setTimeout(t,s))),await i())};await i()}let E;!function(t){let e;!function(t){let e,s;var i;!function(t){t[t.ASC=1]="ASC",t[t.DES=-1]="DES"}(e||(e={})),t.Order=e,t.create=function(t){return(s,i)=>{for(let r=0;r<t.length;r++){const o=t[r],n=o.comparer(s[o.key],i[o.key]);if(0!==n)return o.order===e.DES?n*o.order:n}return 0}},(i=s||(s=t.Comparer||(t.Comparer={}))).bool=function(t,e){if(t||e){if(!t)return 1;if(!e)return-1}return 0},i.number=function(t,e){return t>e?1:t<e?-1:0}}(e||(e=t.Sorter||(t.Sorter={}))),t.asyncForEach=async function(t,e){for(let s=0;s<t.length;s++)await e(t[s],s,t)},t.asyncFilter=async function(t,e){let s=[];for(let i=0;i<t.length;i++)await e(t[i],i,t)&&s.push(t[i]);return s},t.asyncMap=async function(t,e){let s=[];for(let i=0;i<t.length;i++)s.push(await e(t[i],i,t));return s}}(E||(E={}));var M=s("l6RJ"),R=s("V5c5");let O;!function(t){t[t.Init=1]="Init",t[t.Running=2]="Running",t[t.Pause=3]="Pause",t[t.Restart=4]="Restart",t[t.Stop=5]="Stop"}(O||(O={}));const A={1:"Init",2:"Running",3:"Pause",4:"Restart",5:"Stop"};class T{constructor(t){this.entity=t}get id(){return this.entity.userId}get displayName(){return this.entity.displayName}get creatorId(){return this.entity.creatorId}get totalMembers(){return this.entity.totalMember}get topMembers(){return this.entity.topMember}get visibility(){return this.entity.visibility}isOwner(t){return this.creatorId===t}isAdmin(t){const e=this.topMembers.find((e=>e.id===t));return!(null==e||!e.isAdmin)}}class I{constructor(t){this.entity=t}get msgId(){return this.entity.msgId}get sendDttm(){return this.entity.sendDttm}get localDttm(){return this.entity.localDttm}isReceivedBefore(t){return this.entity.localDttm<t}}class D{constructor(t,e){this.entity=t,this.muteManager=e}get id(){return this.entity.userId}get isGroup(){return this.entity.isGroup}get isPinned(){return this.entity.pinned>0}get isMuted(){return!!this.muteManager.isMuted(this.id)}}const S=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return}else if("object"==typeof t)return Object(c.a)({},t)};class F{constructor(t){this.entity=t}get id(){return this.entity.userId}get msgId(){return this.entity.msgId}get sendDttm(){return this.entity.sendDttm}get isGroup(){return this.entity.userId.startsWith("g")}get isPhoto(){if("image"==this.entity.type){var t;if(1==this.entity.subType)return!0;const e=S(null===(t=this.entity.message)||void 0===t?void 0:t.params);if(null!=e&&e.width&&null!=e&&e.height)return!0}return!1}get isVideo(){if("image"==this.entity.type){var t;if(2==this.entity.subType)return!0;const e=S(null===(t=this.entity.message)||void 0===t?void 0:t.params);if(null!=e&&e.video_height&&null!=e&&e.video_width)return!0}return!1}get isFile(){return"file"==this.entity.type}get raw(){return this.entity}get type(){return this.isPhoto?"image":this.isFile?"file":this.isVideo?"video":"unknow"}}var C=s("qGG5"),w=s("uP4a"),P=s("JprO"),_=s("igA5");const L=s("oyvS");class G{constructor(t,e,s,i,r,o,n){this.groupManager=t,this.conversationManager=e,this.muteManager=s,this.messageManager=i,this.downloadConcurManager=r,this.mediaManager=o,this.logger=n,Object(g.a)(this,"storage",void 0),Object(g.a)(this,"fetched",0),Object(g.a)(this,"lastFetched",0),Object(g.a)(this,"isLogMaxSession",!1),Object(g.a)(this,"leaveGroups",new Set),Object(g.a)(this,"fetchingGroups",[]),Object(g.a)(this,"fetching",0),Object(g.a)(this,"active",!1),Object(g.a)(this,"fetchRetryInfo",{retry:-1,retryId:"",lastRetry:0,lastRetryKey:"",groupId:""}),Object(g.a)(this,"downloadEntry",void 0),this.storage=new N,this.downloadEntry=new w.c(w.a.Dev)}get setting(){return m.default.downloadOldMedia}async calculateScope(t){var e;this.resetFetchRetryInfo(),this.storage.load();let s=this.getVerifySettingAction();const i=this.handleVerifySettingAction(s);let r=this.storage.getAll();if(i||0===r.length){var o;let e=(await this.groupManager.getGroupsListSync()).map((t=>new T(t)));if(0===e.length)return this.logger.zsymb(0,11326,3e4,"groupManager.getAll return empty"),[];if(this.setting.preparing.forceRecalculate)r=await this.calculateScopeMeta(e);else{const t=e.filter((t=>!this.storage.has(t.id))),s=await this.calculateScopeMeta(t);r=[...r,...s]}if(null!=t&&null!==(o=t.signal)&&void 0!==o&&o.aborted)return[];this.storage.sync(r),this.submitStartDownloadLog(e,r)}return null!=t&&null!==(e=t.signal)&&void 0!==e&&e.aborted?[]:(this.storage.setting=Object(c.a)({},this.setting),this.fetching=0,r.sort(this.getFetchGroupSorter()),this.fetchingGroups=r.map((t=>t.id)),this.logger.zsymb(12,11326,30001,(()=>["config",this.setting])),this.logger.zsymb(12,11326,30002,(()=>[`total groups: ${r.length}`])),this.logger.zsymb(0,11326,30003,(()=>["done:",r.filter((t=>t.done)).map((t=>t.id)).join()||"[]"])),this.logger.zsymb(0,11326,30004,(()=>["phaseDone:",r.filter((t=>t.phaseDone)).map((t=>t.id)).join()||"[]"])),this.logger.zsymb(0,11326,30005,(()=>["fetching:",r.filter((t=>!t.done&&!t.phaseDone)).map((t=>t.id)).join()||"[]"])),r)}async calculateScopeMeta(t){const e=[],s=this.setting.preparing.groupsChunkSize,i=d()(t,s),r=Date.now(),o=this.setting.groupConstrains.maxActiveTime,n=v(o,r),a=async t=>{let s=!1,i=!1,a=-1,h=-1;const l=await this.getLastMessage(t.id);if(l){if(a=Number.parseInt(l.sendDttm),a<o)return;h=v(a,r)}if(-1===h){if(this.setting.groupConstrains.requireActiveTime)return void this.storage.delete(t.id);h=n}const c=await this.getConversation(t.id);c&&(s=c.isPinned,i=c.isMuted),e.push({id:t.id,name:"",totalMembers:t.totalMembers,isOwnerOrAdmin:t.isAdmin("")||t.isOwner(""),lastActiveTime:a,lastActiveTimeInDays:h,isPinned:s,isMuted:i,done:!1,phaseDone:!1,progress:{startDttm:0,fetchedMsg:0,errorMsg:0,fetchingFileMsgId:C.g,fetchingFileMsgDttm:Date.now(),fetchingFileDone:!1,fetchingPhotoMsgId:C.g,fetchingPhotoMsgDttm:Date.now(),fetchingPhotoDone:!1,fetchedFileMsg:0,fetchedPhotoMsg:0,fetchedVideoMsg:0,fetchedFileBytes:0,fetchedPhotoBytes:0,fetchedVideoBytes:0,fileMsgSegment:0,videoMsgSegment:0,photoMsgSegment:0}})};return await b(i,(async t=>{0!==(t=t.filter((t=>!this.isIgnoredGroup(t)))).length&&await b(t,a)}),this.setting.preparing.debounceBetweenChunk),e}async prepareBeforeFetch(){if(this.isFetched(this.fetchingGroups[this.fetching]))for(;this.fetching<this.fetchingGroups.length;this.fetching++){let t=this.fetchingGroups[this.fetching];if(!this.isFetched(t))break}let t=this.fetchingGroups[this.fetching],e=this.getFetchingInfo(this.fetching);if(!e)return this.fetching=-1,this.submitFetchedAllGroupLog(C.m.FETCHED_ALL),{fetchedAll:!0};let s=Object(c.a)({},e),{fetchingFileMsgDttm:i,fetchingFileMsgId:r,fetchingPhotoMsgId:o,fetchingPhotoMsgDttm:n,fetchedMsg:a,errorMsg:h}=s.progress;if(s.progress.startDttm||(s.progress.startDttm=Date.now(),this.storage.set(t,Object(c.a)({},s))),this.leaveGroups.has(t))return this.logger.zsymb(0,11326,30006,`prepare fetch group:${t} group leave -> done`),s.done=!0,this.storage.set(t,Object(c.a)({},s)),this.submitFetchedGroupLog(s,C.f.GROUP_LEAVE),{fetchedAll:!1};if(a+h>=this.setting.limit.maxMsgPerGroup)return this.logger.zsymb(0,11326,30007,`prepare fetch group:${t} reach maxMsgPerGroup -> phaseDone`),s.phaseDone=!0,this.storage.set(t,Object(c.a)({},s)),this.submitFetchedGroupLog(s,C.f.PHASE_END),{fetchedAll:!1};let l=await this.getMediaFromConversation(t,1,r,C.h.files),g=await this.getMediaFromConversation(t,1,o,C.h.images);if(!l||!g)return this.logger.zsymb(0,11326,30008,`prepare fetch group:${t} db error -> skip`),this.storage.set(t,Object(c.a)(Object(c.a)({},s),{},{phaseDone:!0})),{fetchedAll:!1};let u=l[0],d=g[0];return(i<=this.setting.limit.minMsgDttm||!u)&&(s.progress.fetchingFileDone=!0),(n<=this.setting.limit.minMsgDttm||!d)&&(s.progress.fetchingPhotoDone=!0),s.progress.fetchingFileDone&&s.progress.fetchingPhotoDone&&(d||u?(this.logger.zsymb(0,11326,30009,`fetch group:${t} phase done`),s.phaseDone=!0,this.storage.set(t,Object(c.a)({},s)),this.submitFetchedGroupLog(s,C.f.PHASE_END)):(this.logger.zsymb(0,11326,30010,`fetch group:${t} done`),s.done=!0,this.storage.set(t,Object(c.a)({},s)),this.submitFetchedGroupLog(s,C.f.FULL_MESSAGE))),{fetchedAll:!1}}async fetchMedia(t){var e;let s=this.fetchingGroups[this.fetching],i=this.getFetchingInfo(this.fetching);if(!i||this.isFetched(s))return;let r=Object(c.a)({},i);this.restartFetchRetry(r);let{fetchingFileMsgId:o,fetchingPhotoMsgId:n,fetchedMsg:a,errorMsg:h}=r.progress;if(this.logger.zsymb(0,11326,30011,`fetching group:${s}, lastFileMsgId: ${o}, lastPhotoMsgId: ${n}`),null!=t&&null!==(e=t.signal)&&void 0!==e&&e.aborted)return;let l=this.setting.fetching.msgPerBatch;if(!isNaN(this.setting.limit.maxMsgPerGroup)){let t=this.setting.limit.maxMsgPerGroup-(a+h);if(t<=0)return;l=Math.min(Math.ceil(t/2),l)}let g=await this.getMediaFromConversation(s,l,o,C.h.files),u=await this.getMediaFromConversation(s,l,n,C.h.images);if(!u||!g)return;let d=[...g,...u].sort(((t,e)=>e.sendDttm-t.sendDttm));if(d=this.fetchNewMedia(r,d),!d.length)return this.logger.zsymb(12,11326,30012,(()=>[`fetching group:${s} batch empty`])),void this.storage.set(s,Object(c.a)({},r));let m={},f={};this.logger.zsymb(12,11326,30013,(()=>[`fetching group:${s} batch ${d.length} msgIds: ${d.map((t=>t.msgId))}`]));for(let c=0;c<d.length;c++)try{let e=d[c].isPhoto?w.f.Photo:d[c].isVideo?w.f.Video:w.f.File;const s=this.downloadEntry.getBuilder().withType(e).withMode(w.e.OldAuto).withConvType(2).withCode(w.d.OldAutoDownload).build();let i=await P.a.autoRunOldMedia(d[c].raw,{entry:s,options:{limit:{fileSize:this.setting.fetching.maxMsgFileSize},signal:t.signal,saveDir:this.getMediaSaveDir(d[c]),srcAction:P.a.constants.srcAction.OldAuto,duplicate:!1,showProgress:{progressBar:!1,taskBar:!1}}});i.fetchedSize&&(m[d[c].msgId]=i.fetchedSize)}catch(v){f[d[c].msgId]=v}const p=t=>{t.isFile&&(r.progress.errorMsg++,r.progress.fetchingFileMsgDttm=t.sendDttm,r.progress.fetchingFileMsgId=t.msgId),(t.isPhoto||t.isVideo)&&(r.progress.errorMsg++,r.progress.fetchingPhotoMsgDttm=t.sendDttm,r.progress.fetchingPhotoMsgId=t.msgId),this.storage.set(s,Object(c.a)({},r))},y=t=>{t.isFile&&(m[t.msgId]&&(r.progress.fetchedMsg++,r.progress.fetchedFileMsg++,r.progress.fetchedFileBytes+=m[t.msgId]),r.progress.fetchingFileMsgDttm=t.sendDttm,r.progress.fetchingFileMsgId=t.msgId),(t.isPhoto||t.isVideo)&&(t.isPhoto&&m[t.msgId]&&(r.progress.fetchedPhotoMsg++,r.progress.fetchedMsg++,r.progress.fetchedPhotoBytes+=m[t.msgId]),t.isVideo&&m[t.msgId]&&(r.progress.fetchedVideoMsg++,r.progress.fetchedMsg++,r.progress.fetchedVideoBytes+=m[t.msgId]),r.progress.fetchingPhotoMsgDttm=t.sendDttm,r.progress.fetchingPhotoMsgId=t.msgId),this.storage.set(s,Object(c.a)({},r))};this.logger.zsymb(12,11326,30014,(()=>[`fetching group:${s}`,"success: "+(d.length-Object.keys(f).length),`error: ${Object.keys(f).length}`]));for(let c=0;c<d.length;c++){let t=d[c],e=f[t.msgId];if(e){let i=Object(R.c)(e),r=Object(R.b)(e);if(null!=t&&t.isPhoto&&this.isSkipFetchErrorPhoto(e)||this.isSkipFetchError(e))this.fetchRetryInfo.retryId==t.msgId&&this.resetFetchRetryInfo(),p(t);else{if(i||r){let t,o;return this.logger.zsymb(12,11326,30015,(()=>[`fetching group:${s}`,`msgId: ${d[c].msgId}`,`type: ${d[c].type}`,`pause error: ${(null==e?void 0:e.message)||(null==e?void 0:e.name)}`])),i&&(t=C.j.FETCH_PAUSE_SYSTEM,o=C.k.FETCH_PAUSE_SYSTEM),r&&(t=C.j.FETCH_PAUSE_NETWORK,o=C.k.FETCH_PAUSE_NETWORK),this.submitPauseFetchGroupLog(o),this.submitPauseFetchAllGroupLog(o),t}if(this.isAbortFetchError(e))return this.logger.zsymb(12,11326,30016,(()=>[`fetching group:${s}`,`msgId: ${d[c].msgId}`,`type: ${d[c].type}`,`abort error: ${(null==e?void 0:e.message)||(null==e?void 0:e.name)}`])),C.j.FETCH_ABORT;{this.logger.zsymb(12,11326,30017,(()=>[`fetching group:${s}`,`msgId: ${d[c].msgId}`,`type: ${d[c].type}`,`retry error: ${(null==e?void 0:e.message)||(null==e?void 0:e.name)}`])),this.fetchRetryInfo.retryId&&this.fetchRetryInfo.retryId==t.msgId||(this.resetFetchRetryInfo(),this.fetchRetryInfo.retryId=t.msgId,this.fetchRetryInfo.groupId=t.id),this.fetchRetryInfo.lastRetry=Date.now(),this.fetchRetryInfo.retry+=1;let i=this.setting.fetching.retryTimes[this.fetchRetryInfo.retry];if(i)return this.logger.zsymb(0,11326,30019,(()=>[`fetching group:${s}`,`msgId:${t.msgId}`,`go retry: ${this.fetchRetryInfo.retry}, ${i} ms`])),C.j.FETCH_RETRY;this.logger.zsymb(0,11326,30018,(()=>[`fetching group:${s}`,`msgId:${this.fetchRetryInfo.retryId}`,"no more fetch retry","skip"])),this.resetFetchRetryInfo(),p(t)}}}else this.fetchRetryInfo.retryId==t.msgId&&this.resetFetchRetryInfo(),y(t)}}restartFetchRetry(t){this.fetchRetryInfo.groupId&&t.id!=this.fetchRetryInfo.groupId&&this.resetFetchRetryInfo()}fetchNewMedia(t,e){return e=e.filter((e=>!(Date.now()-e.sendDttm<this.setting.limit.msgCheckPointTs)||(P.a.autoRunOldMedia(e.raw,{options:{limit:{fileSize:this.setting.fetching.maxMsgFileSize},saveDir:this.getMediaSaveDir(e),srcAction:P.a.constants.srcAction.Auto,duplicate:!1,showProgress:{progressBar:!1,taskBar:!1}}}),e.isFile&&(t.progress.fetchingFileMsgId=e.msgId,t.progress.fetchingFileMsgDttm=e.sendDttm),(e.isPhoto||e.isVideo)&&(t.progress.fetchingPhotoMsgId=e.msgId,t.progress.fetchingPhotoMsgDttm=e.sendDttm),!1)))}verifyPauseCode(){let t=C.j.NONE_PAUSE;try{let e=Object(y.d)();this.isAppActive()?t=C.j.APPLICATION_ACTIVE:this.setting.enable?this.isEnableDownload()?Object(y.l)(e,this.setting.limit.maxDiskRate)?(t=C.j.DISK_QUOTA_EXCEED,this.submitPauseFetchGroupLog(C.k.DISK_QUOTA_EXCEED),this.submitPauseFetchAllGroupLog(C.k.DISK_QUOTA_EXCEED)):this.isGroupSessionLimit()?(t=C.j.GROUP_QUOTA_EXCEED,this.isLogMaxSession||(this.isLogMaxSession=!0,this.submitPauseFetchAllGroupLog(C.k.GROUP_QUOTA_EXCEED))):this.isBusyHour()?t=C.j.BUSY_TIME:this.isFetchRetry()&&(t=C.j.FETCH_RETRY):t=C.j.FEATURE_OFF_DOWNLOAD:t=C.j.FEATURE_DISABLE}catch{t=C.j.EXCEPTION_ERROR}return t}isAppActive(){return this.active}isStaleState(t,e){return e!==t}isFetchRetry(){return!!this.fetchRetryInfo.retryId&&(this.logger.zsymb(0,11326,30020,`fetch retry compare: ${Date.now()-this.fetchRetryInfo.lastRetry}, ${this.setting.fetching.retryTimes[this.fetchRetryInfo.retry]}`),Date.now()-this.fetchRetryInfo.lastRetry<this.setting.fetching.retryTimes[this.fetchRetryInfo.retry])}isFetched(t){const e=this.storage.get(t);return!e||(e.done||e.phaseDone)}isEnableDownload(){return this.downloadConcurManager.getEnable("oldauto")}verifySetting(){switch(this.getVerifySettingAction()){case C.n.RESTART:case C.n.RECALCULATE:case C.n.UPDATE_LIMIT:return!0}return!1}isBusyHour(){var t,e;const s=(new Date).getUTCHours();return(null===(t=this.setting.fetching)||void 0===t||null===(e=t.busyHours)||void 0===e?void 0:e.indexOf(s))>-1}isGroupSessionLimit(){var t;return null!==(t=this.setting.quota)&&void 0!==t&&t.sessionLen&&this.lastFetched>0&&Date.now()-this.lastFetched>=this.setting.quota.sessionLen&&this.fetched>=this.setting.quota.maxGroupsPerSession&&(this.fetched=0,this.isLogMaxSession=!1,this.logger.zsymb(0,11326,30021,`reset group sessions limit 1- ${this.fetched}/${this.setting.quota.maxGroupsPerSession}`)),this.fetched>=this.setting.quota.maxGroupsPerSession}handleVerifySettingAction(t){switch(t){case C.n.RESTART:return this.logger.zsymb(0,11326,30022,"received new setting. action: restart"),this.storage.reset(),!0;case C.n.RECALCULATE:return this.logger.zsymb(0,11326,30023,"received new setting. action: recalculate"),this.resetGroupsLimit(),!0;case C.n.UPDATE_LIMIT:return this.logger.zsymb(0,11326,30024,"received new setting. action: update limit"),this.resetGroupsLimit(),!1}return this.logger.zsymb(0,11326,30025,"received new setting. action: none"),!1}resetGroupsLimit(){this.storage.getAll().forEach((t=>{const e=this.resetGroupLimit(t);this.storage.set(e.id,e)})),this.storage.save()}resetGroupLimit(t){if(!t||t.done)return t;const e=Object(c.a)({},t.progress),s=Object(c.a)(Object(c.a)({},t),{},{progress:e});return s.phaseDone=!1,s.progress&&(s.progress.fetchingPhotoDone=!1,s.progress.fetchingFileDone=!1),s}getVerifySettingAction(){const t=this.storage.setting,e=this.setting;if(t){if(t.version<e.version)return C.n.RESTART;const s=t.groupConstrains,i=e.groupConstrains;if(s&&i){if(s.maxActiveTime>i.maxActiveTime||s.maxNumOfMembers>i.maxNumOfMembers||!s.requireActiveTime&&i.requireActiveTime)return C.n.RESTART;if(s.maxActiveTime!=i.maxActiveTime||s.maxNumOfMembers!=i.maxNumOfMembers||s.requireActiveTime!=i.requireActiveTime)return C.n.RECALCULATE}const r=t.limit,o=e.limit;if(r&&o&&(r.maxMsgPerGroup!==o.maxMsgPerGroup||r.minMsgDttm!==o.minMsgDttm))return C.n.UPDATE_LIMIT;o&&i||this.logger.zsymb(12,11326,30026,(()=>["current config",e]))}return C.n.NONE}getLastMessage(t){return this.messageManager.getPreviewMessage(t).then((t=>t.previewMsg&&new I(t.previewMsg))).catch((()=>{}))}getConversation(t){return this.conversationManager.getConvById(t).then((t=>{if(t)return new D(t,this.muteManager)})).catch((()=>{}))}isAbortFetchError(t){let e=["DOWNLOAD_ABORT"],s=!1;for(let o=0;o<e.length;o++){var i,r;if(null!=t&&null!==(i=t.name)&&void 0!==i&&i.includes(e[o])||null!=t&&null!==(r=t.message)&&void 0!==r&&r.includes(e[o])){s=!0;break}}return s}isSkipFetchErrorPhoto(t){let e=["302","304","307"],s=!1;for(let o=0;o<e.length;o++){var i,r;if(null!=t&&null!==(i=t.name)&&void 0!==i&&i.includes(e[o])||null!=t&&null!==(r=t.message)&&void 0!==r&&r.includes(e[o])){s=!0;break}}return s}isSkipFetchError(t){let e=["404","OLD_AUTO_FILE_SIZE_INVALID","OLD_AUTO_LIMIT","FILE_SIZE_LIMIT_EXCEED","OBJ_DOWNLOAD_SAVE_DIR_INVALID"],s=!1;for(let o=0;o<e.length;o++){var i,r;if(null!=t&&null!==(i=t.name)&&void 0!==i&&i.includes(e[o])||null!=t&&null!==(r=t.message)&&void 0!==r&&r.includes(e[o])){s=!0;break}}return s}getFetchingGroupId(){return this.fetchingGroups[this.fetching]}getFetchingInfo(t){return this.storage.get(this.fetchingGroups[t])}resetFetchRetryInfo(){this.fetchRetryInfo={retry:-1,retryId:"",lastRetry:0,groupId:"",lastRetryKey:""}}getMediaFromConversation(t,e,s,i){return this.mediaManager.getMediaFromConversationWhenDownloadOldMedia(t,e,s,i).then((t=>t.length?t.map((t=>new F(t))):[])).catch((t=>{}))}isMaxMsgId(t){return t==C.g}isIgnoredGroup(t){return t.totalMembers>this.setting.groupConstrains.maxNumOfMembers}getFetchGroupSorter(){return E.Sorter.create([{key:"isPinned",comparer:E.Sorter.Comparer.bool},{key:"isOwnerOrAdmin",comparer:E.Sorter.Comparer.bool},{key:"isMuted",comparer:E.Sorter.Comparer.bool,order:E.Sorter.Order.DES},{key:"lastActiveTimeInDays",comparer:E.Sorter.Comparer.number},{key:"totalMembers",comparer:E.Sorter.Comparer.number},{key:"lastActiveTime",comparer:E.Sorter.Comparer.number,order:E.Sorter.Order.DES}])}getMediaSaveDir(t){if(t.isPhoto)try{return L.dirname(Object(M.e)(t.raw).oriPath)}catch(e){}}getDiskUsage(){let t=Object(y.d)();const{result:e}=Object(y.f)(t);return[isNaN(null==e?void 0:e.total)?0:null==e?void 0:e.total,isNaN(null==e?void 0:e.available)?0:null==e?void 0:e.available]}submitPauseFetchGroupLog(t){const e=this.fetchingGroups.map((t=>this.storage.get(t))),s=e.length,i=this.fetching,r=e[i],o=p.default.getZaloClientID();if(!r.done&&!r.phaseDone&&r&&t){this.logger.zsymb(0,11326,30027,(()=>["submit pause fetch log",`id: ${r.id}`]));try{var n,a,h;f.e.logActionInfo(f.b.AutoDownloadOldMedia,C.a.FETCHED_GROUP,[t,i,s,JSON.stringify([r.progress.fetchedPhotoMsg,r.progress.fetchedFileMsg,r.progress.fetchedVideoMsg]),JSON.stringify([parseFloat(null===(n=r.progress.fetchedPhotoBytes/1048576)||void 0===n?void 0:n.toFixed(6)),parseFloat(null===(a=r.progress.fetchedFileBytes/1048576)||void 0===a?void 0:a.toFixed(6)),parseFloat(null===(h=r.progress.fetchedVideoBytes/1048576)||void 0===h?void 0:h.toFixed(6))]),Date.now()-r.progress.startDttm,JSON.stringify([this.setting.version,this.setting.groupConstrains.maxNumOfMembers,this.setting.groupConstrains.maxActiveTime,this.setting.limit.maxDiskRate,this.setting.limit.minMsgDttm,this.setting.limit.maxMsgPerGroup]),o])}catch{}}}submitFetchedGroupLog(t,e=C.f.UNKNOWN){try{var s,i,r;const o=Date.now();this.fetched>=this.setting.quota.maxGroupsPerSession&&this.setting.quota.sessionLen&&this.lastFetched>0&&o-this.lastFetched>=this.setting.quota.sessionLen?(this.fetched=1,this.isLogMaxSession=!1,this.logger.zsymb(0,11326,30028,`reset group sessions limit 2- ${this.fetched}/${this.setting.quota.maxGroupsPerSession}`)):this.fetched+=1,this.lastFetched=o;const n=this.fetchingGroups.map((t=>this.storage.get(t))),a=n.filter((t=>t.done||t.phaseDone)).length,h=n.length,l=t.progress.fetchedMsg,c=p.default.getZaloClientID();let g=this.fetchingGroups.findIndex((e=>e==t.id));g+=1,this.logger.zsymb(0,11326,30029,`done:${t.id} fetched:${l} code:${e} index:${g} - ${a}/${h} - ${this.fetched}/${this.setting.quota.maxGroupsPerSession}`),f.e.logActionInfo(f.b.AutoDownloadOldMedia,C.a.FETCHED_GROUP,[e,g,h,JSON.stringify([t.progress.fetchedPhotoMsg,t.progress.fetchedFileMsg,t.progress.fetchedVideoMsg]),JSON.stringify([parseFloat(null===(s=t.progress.fetchedPhotoBytes/1048576)||void 0===s?void 0:s.toFixed(6)),parseFloat(null===(i=t.progress.fetchedFileBytes/1048576)||void 0===i?void 0:i.toFixed(6)),parseFloat(null===(r=t.progress.fetchedVideoBytes/1048576)||void 0===r?void 0:r.toFixed(6))]),Date.now()-t.progress.startDttm,JSON.stringify([this.setting.version,this.setting.groupConstrains.maxNumOfMembers,this.setting.groupConstrains.maxActiveTime,this.setting.limit.maxDiskRate,this.setting.limit.minMsgDttm,this.setting.limit.maxMsgPerGroup]),c])}catch{}}submitStartDownloadLog(t,e){const s=t.length,i=e.length,r=e.filter((t=>!t.done&&!t.phaseDone)).map((t=>t.id.slice(1))).join()||"",o=p.default.getZaloClientID();try{const t=[s,i,r,JSON.stringify([this.setting.version,this.setting.groupConstrains.maxNumOfMembers,this.setting.groupConstrains.maxActiveTime,this.setting.limit.maxDiskRate,this.setting.limit.minMsgDttm,this.setting.limit.maxMsgPerGroup]),JSON.stringify(this.getDiskUsage().map((t=>Math.round(t/1048576)))),o];f.e.logActionInfo(f.b.AutoDownloadOldMedia,C.a.CALCULATED_SCOPE,t)}catch{}}submitPauseFetchAllGroupLog(t){if(!t)return;const e=this.fetchingGroups.map((t=>this.storage.get(t))),s=e.filter((t=>t.done||t.phaseDone)),i=e.filter((t=>t.done)),r=p.default.getZaloClientID();try{f.e.logActionInfo(f.b.AutoDownloadOldMedia,C.a.FETCHED_ALL,[t,s.length,i.length,e.length,JSON.stringify([this.setting.version,this.setting.groupConstrains.maxNumOfMembers,this.setting.groupConstrains.maxActiveTime,this.setting.limit.maxDiskRate,this.setting.limit.minMsgDttm,this.setting.limit.maxMsgPerGroup]),JSON.stringify(this.getDiskUsage().map((t=>Math.round(t/1048576)))),r])}catch{}}async submitFetchedAllGroupLog(t){const e=this.fetchingGroups.map((t=>this.storage.get(t))),s=e.filter((t=>t.done||t.phaseDone)),i=e.filter((t=>t.phaseDone)),r=e.filter((t=>t.done)),o=s.length,n=e.length,a=p.default.getZaloClientID();try{const h=this.setting.limit.maxMsgPerGroup;this.logger.zsymb(0,11326,30030,`all done! code:${t} done:${o} phase:${i.length} scoped-groups:${n} totalsPerGroup:${h}`),f.e.logActionInfo(f.b.AutoDownloadOldMedia,C.a.FETCHED_ALL,[t,s.length,r.length,e.length,JSON.stringify([this.setting.version,this.setting.groupConstrains.maxNumOfMembers,this.setting.groupConstrains.maxActiveTime,this.setting.limit.maxDiskRate,this.setting.limit.minMsgDttm,this.setting.limit.maxMsgPerGroup]),JSON.stringify(this.getDiskUsage().map((t=>Math.round(t/1048576)))),a])}catch{}}dispose(){this.storage.hardReset()}}class N{constructor(){Object(g.a)(this,"cache",new Map),Object(g.a)(this,"_setting",void 0)}get setting(){return this._setting}set setting(t){this._setting=t;_.a.getInstance().setItemForCurrentUser(`${C.e}_setting`,JSON.stringify(t))}getAll(){return Array.from(this.cache.values())}get(t){return this.cache.get(t)}delete(t){this.cache.delete(t),this.save()}set(t,e){this.cache.set(t,e),this.save()}has(t){return this.cache.has(t)}load(){const t=_.a.getInstance(),e=t.getItemForCurrentUser(`${C.e}_info`),s=t.getItemForCurrentUser(`${C.e}_setting`);if(e)try{this.cache=new Map(JSON.parse(e))}catch(i){}if(s)try{this.setting=JSON.parse(s)}catch(i){}this.cache||(this.cache=new Map)}sync(t){this.cache=new Map(t.map((t=>[t.id,t]))),this.save()}save(){_.a.getInstance().setItemForCurrentUser(`${C.e}_info`,JSON.stringify(Array.from(this.cache.entries())))}reset(){this.cache=new Map;_.a.getInstance().removeItemForCurrentUser(`${C.e}_info`)}hardReset(){this.cache=new Map;const t=_.a.getInstance();t.removeItemForCurrentUser(`${C.e}_info`),t.removeItemForCurrentUser(`${C.e}_setting`)}}var j=s("PoHQ");class U{constructor(t,e,s,i,r,o){this.emitter=t,this.services=e,this.application=s,this.ZGroupLeaveCache=i,this.powerMonitor=r,this.logger=o,Object(g.a)(this,"_state",O.Init),Object(g.a)(this,"lastModule",void 0),Object(g.a)(this,"waitTime",void 0),Object(g.a)(this,"fetchRetryTime",void 0),Object(g.a)(this,"fetchIORetryTime",void 0),Object(g.a)(this,"fetchMaxSessionRetryTime",void 0),Object(g.a)(this,"isRunning",!1),Object(g.a)(this,"onServerInfoUpdate",(async()=>{if(this.services.setting.dispose)return void this.onDispose();await this.services.verifySetting()&&this.restart()})),Object(g.a)(this,"onApplicationExit",(()=>{this.stop()})),Object(g.a)(this,"onApplicationIdle",(()=>{this.logger.zsymb(0,9401,30016,"app idle -> resume"),this.services.active=!1,this.resume()})),Object(g.a)(this,"onApplicationActive",(()=>{this.services.active=!0})),this.onGroupLeave=this.onGroupLeave.bind(this),this.onSystemResume=this.onSystemResume.bind(this),this.listenOnEvents(),this.listenIOEvents()}set state(t){this._state=t}get state(){return this._state}start(){this.state!=O.Running?(this.stopListenApplicationEvent(),this.listenApplicationEvents(),document.hasFocus()?this.logger.zsymb(0,9401,30001,"loaded - wait for idle"):(this.state=O.Running,this.lastModule=C.i.Calculator,this.emitter.emit(C.c.DOMReq,{type:"RUNNING",module:C.i.Calculator}))):this.logger.zsymb(18,9401,3e4,(()=>["fail to start",{reason:"invalid state",state:A[this.state]}]))}pause(t){this.state==O.Running?(this.state=O.Pause,this.emitter.emit(C.c.DOMReq,{type:"PAUSE",code:t}),this.handlePauseCode(t)):this.logger.zsymb(18,9401,30002,(()=>["fail to pause",{reason:"invalid state",state:A[this.state]}]))}resume(){this.state!=O.Init?this.state==O.Pause?(this.clearFetchIORetryTime(),this.clearFetchMaxSessionRetryTime(),this.state=O.Running,this.emitter.emit(C.c.DOMReq,{type:"RESUME",module:this.lastModule})):this.logger.zsymb(18,9401,30003,(()=>["fail to resume",{reason:"invalid state",state:A[this.state]}])):this.start()}stop(){this.stopListenApplicationEvent(),this.state=O.Stop,this.emitter.emit(C.c.DOMReq,{type:"STOP"})}restart(){this.stopListenApplicationEvent(),this.stopRetryTimer(),this.state=O.Init,this.emitter.emit(C.c.DOMReq,{type:"RESTART"}),setTimeout((()=>this.start()),5e3)}leave(){this.state==O.Running?this.emitter.emit(C.c.DOMReq,{type:"GROUP_LEAVE",module:this.lastModule}):this.logger.zsymb(18,9401,30004,(()=>["fail to leave group",{reason:"invalid state",state:A[this.state]}]))}handlePauseCode(t){if(this.logger.zsymb(0,9401,30005,`paused by ${C.l[t]}`),t!=C.j.BUSY_TIME){if(t==C.j.FETCH_RETRY){if(this.fetchRetryTime)return void this.logger.zsymb(0,9401,30009,"waiting for fetch retry");if(this.services.isFetchRetry()){var e,s;let t=null===(e=this.services.setting)||void 0===e||null===(s=e.fetching)||void 0===s?void 0:s.retryTimes[this.services.fetchRetryInfo.retry];isNaN(t)||(this.fetchRetryTime=setTimeout((()=>{this.clearFetchRetryTime(),this.logger.zsymb(0,9401,30010,"resume fetch retry"),this.resume()}),t))}else this.resume()}if(t==C.j.GROUP_QUOTA_EXCEED){var i,r;if(this.fetchMaxSessionRetryTime)return void this.logger.zsymb(0,9401,30011,"waiting for max session retry");let t=(null===(i=this.services.setting)||void 0===i||null===(r=i.quota)||void 0===r?void 0:r.sessionLen)-(Date.now()-this.services.lastFetched);!isNaN(t)&&t>0&&(this.fetchMaxSessionRetryTime=setTimeout((()=>{this.clearFetchMaxSessionRetryTime(),this.resume()}),t))}if(t==C.j.FETCH_PAUSE_NETWORK||t==C.j.FETCH_PAUSE_SYSTEM||t==C.j.DISK_QUOTA_EXCEED){var o,n;if(this.fetchIORetryTime)return void this.logger.zsymb(0,9401,30012,"waiting for fetch io retry");let t=null===(o=this.services.setting)||void 0===o||null===(n=o.fetching)||void 0===n?void 0:n.ioRetryTime;isNaN(t)||(this.fetchIORetryTime=setTimeout((()=>{this.clearFetchIORetryTime(),this.logger.zsymb(0,9401,30013,"resume fetch io retry"),this.resume()}),t))}t==C.j.FEATURE_DISABLE&&(this.logger.zsymb(0,9401,30014,"feature disable wait for new config"),this.stop())}else{let t=1e3;if(this.waitTime)return void this.logger.zsymb(0,9401,30006,"waiting for free time");if(this.services.isBusyHour()){const e=(new Date).getUTCMinutes();t=60*Math.max(60-e,1)*1e3,this.logger.zsymb(0,9401,30007,`server busy. retry after ${t}`)}this.waitTime=setTimeout((()=>{this.clearWaitTime(),this.logger.zsymb(0,9401,30008,"resume from busy hours"),this.resume()}),t)}}listenOnEvents(){this.emitter.on(C.c.DOMResp,(t=>{switch(t.type){case"PAUSE":this.pause(t.code);break;case"STOP":this.stop();break;case"RESTART":this.restart();break;case"RUNNING":this.state==O.Running&&(this.lastModule=t.module,setImmediate((()=>this.emitter.emit(C.c.DOMReq,Object(c.a)({},t)))))}}))}onSystemResume(){this.logger.zsymb(0,9401,30015,"system sleep -> resume"),this.resume()}removeOnEvents(){this.emitter.removeAllListeners(C.c.DOMReq)}onDispose(){this.stopListenApplicationEvent(),this.stopListenIOEvents(),this.stopRetryTimer(),this.stop(),this.services.dispose()}onGroupLeave(t){this.services.leaveGroups.add(t),this.leave()}listenIOEvents(){j.p.listenEvent(j.l,this.onServerInfoUpdate),this.ZGroupLeaveCache.addGroupLeaveListener(this.onGroupLeave),this.powerMonitor.on("resume",this.onSystemResume)}stopListenIOEvents(){this.ZGroupLeaveCache.removeGroupLeaveListener(this.onGroupLeave),j.p.removeListenEvent(j.l,this.onServerInfoUpdate),this.powerMonitor.removeListener("resume",this.onSystemResume)}listenApplicationEvents(){this.application.addEventListener(o.b.Idle,this.onApplicationIdle),this.application.addEventListener(o.b.Active,this.onApplicationActive),this.application.addEventListener(o.b.Exit,this.onApplicationExit)}stopListenApplicationEvent(){this.application.removeEventListener(o.b.Idle,this.onApplicationIdle),this.application.removeEventListener(o.b.Active,this.onApplicationActive),this.application.removeEventListener(o.b.Exit,this.onApplicationExit)}stopRetryTimer(){this.clearFetchRetryTime(),this.clearWaitTime(),this.clearFetchIORetryTime(),this.clearFetchMaxSessionRetryTime()}clearFetchMaxSessionRetryTime(){this.fetchMaxSessionRetryTime&&(clearTimeout(this.fetchMaxSessionRetryTime),this.fetchMaxSessionRetryTime=void 0)}clearFetchRetryTime(){this.fetchRetryTime&&(clearTimeout(this.fetchRetryTime),this.fetchRetryTime=void 0)}clearWaitTime(){this.waitTime&&(clearTimeout(this.waitTime),this.waitTime=void 0)}clearFetchIORetryTime(){this.fetchIORetryTime&&(clearTimeout(this.fetchIORetryTime),this.fetchIORetryTime=void 0)}}class x{constructor(t,e){this.services=t,this.logger=e,Object(g.a)(this,"abortController",new AbortController)}get aborted(){var t,e;return!(null===(t=this.abortController)||void 0===t||null===(e=t.signal)||void 0===e||!e.aborted)}abort(){var t;null===(t=this.abortController)||void 0===t||t.abort()}async calculateScope(){if(this.aborted)return C.b.CACL_ABORT;try{let t=await this.services.calculateScope({signal:this.abortController.signal});if(this.aborted)return C.b.CACL_ABORT;const e=t.filter((t=>t.done));if(this.logger.zsymb(3,9400,3e4,"calculated scope, groups:{}",t.length),t.length>0&&e.length>=t.length||!t.length)return this.logger.zsymb(3,9400,30001,"all done! wait for next config."),this.services.submitFetchedAllGroupLog(C.m.ALL_DONE),C.b.ALL_DONE}catch(e){var t;return this.logger.zsymb(3,9400,30002,"calculate scope error:",(null==e||null===(t=e.stack)||void 0===t?void 0:t.slice(0,100))||(null==e?void 0:e.message)||(null==e?void 0:e.name)),this.aborted?C.b.CACL_ABORT:C.b.CACL_ERROR}return C.b.CACL_DONE}}class z{constructor(t,e,s){this.emitter=t,this.services=e,this.logger=s,Object(g.a)(this,"symbol",C.i.Calculator),Object(g.a)(this,"calculator",void 0),this.listenOnEvents()}async calculateScope(){let t=this.calculator,e={};switch(await(null==t?void 0:t.calculateScope())){case C.b.ALL_DONE:e={type:"STOP",code:C.m.ALL_DONE};break;case C.b.CACL_ERROR:e={type:"PAUSE",code:C.j.CALC_ERROR};break;case C.b.CACL_DONE:e={type:"RUNNING",module:C.i.Fetcher}}null!=t&&t.aborted||(null==t||t.abort(),t===this.calculator&&(this.calculator=void 0),this.emitter.emit(C.c.DOMResp,Object(c.a)({},e)))}listenOnEvents(){this.emitter.on(C.c.DOMReq,(t=>{var e;switch(t.type){case"RUNNING":case"RESUME":t.module!=this.symbol||this.calculator||(this.calculator=new x(this.services,this.logger),this.calculateScope());break;case"PAUSE":case"STOP":case"RESTART":null===(e=this.calculator)||void 0===e||e.abort(),this.calculator=void 0}}))}removeOnEvents(){this.emitter.removeAllListeners(C.c.DOMReq)}}class ${constructor(t,e){this.services=t,this.logger=e,Object(g.a)(this,"abortController",new AbortController),Object(g.a)(this,"downloadAbortController",new AbortController)}get aborted(){var t,e;return!(null===(t=this.abortController)||void 0===t||null===(e=t.signal)||void 0===e||!e.aborted)}abortFetch(){var t;null===(t=this.downloadAbortController)||void 0===t||t.abort()}abort(){var t;null===(t=this.abortController)||void 0===t||t.abort()}async prefetch(){if(this.aborted)return C.d.FETCH_ABORT;try{if((await this.services.prepareBeforeFetch()).fetchedAll)return C.d.FETCHED_ALL}catch(t){return this.logger.zsymb(0,9399,3e4,(()=>{var e;return["prefetching error:",(null==t||null===(e=t.stack)||void 0===e?void 0:e.slice(0,100))||(null==t?void 0:t.message)||(null==t?void 0:t.name)]})),C.d.PREFETCH_ERROR}return C.d.PREFETCH_DONE}async fetch(){if(this.aborted)return C.d.FETCH_ABORT;try{let t=await this.services.fetchMedia({signal:this.downloadAbortController.signal});if(t==C.j.FETCH_RETRY)return C.d.FETCH_RETRY;if(t==C.j.FETCH_PAUSE_NETWORK)return C.d.FETCH_PAUSE_NETWORK;if(t==C.j.FETCH_PAUSE_SYSTEM)return C.d.FETCH_PAUSE_SYSTEM}catch(t){return this.logger.zsymb(0,9399,30001,(()=>{var e;return["prefetching error:",(null==t||null===(e=t.stack)||void 0===e?void 0:e.slice(0,100))||(null==t?void 0:t.message)||(null==t?void 0:t.name)]})),C.d.FETCH_ERROR}return C.d.FETCH_DONE}}class k{constructor(t,e,s){this.emitter=t,this.services=e,this.logger=s,Object(g.a)(this,"symbol",C.i.Fetcher),Object(g.a)(this,"fetcher",void 0),this.listenOnEvents()}async fetch(){var t,e;let s=this.fetcher,i=await(null==s?void 0:s.prefetch());if(null!=s&&s.aborted)return;if(i==C.d.FETCHED_ALL)return this.logger.zsymb(0,9399,30002,"all done! wait for next config."),void this.emitter.emit(C.c.DOMResp,{type:"STOP",code:C.m.FETCHED_ALL});if(i==C.d.PREFETCH_ERROR)return void this.emitter.emit(C.c.DOMResp,{type:"PAUSE",code:C.j.FETCH_ERROR});if(null!=s&&s.aborted)return;let r=this.services.verifyPauseCode();if(r!==C.j.NONE_PAUSE)return void this.emitter.emit(C.c.DOMResp,{type:"PAUSE",code:r});let o=await(null==s?void 0:s.fetch());if(null!=s&&s.aborted)return;if(o==C.d.FETCH_ERROR)return void this.emitter.emit(C.c.DOMResp,{type:"PAUSE",code:C.j.FETCH_ERROR});let n={};switch(o){case C.d.FETCH_RETRY:n={type:"PAUSE",code:C.j.FETCH_RETRY};break;case C.d.FETCH_PAUSE_SYSTEM:n={type:"PAUSE",code:C.j.FETCH_PAUSE_SYSTEM};break;case C.d.FETCH_PAUSE_NETWORK:n={type:"PAUSE",code:C.j.FETCH_PAUSE_NETWORK}}null!=s&&s.aborted||(null!==(t=n)&&void 0!==t&&t.type&&null!==(e=n)&&void 0!==e&&e.code?this.emitter.emit(C.c.DOMResp,Object(c.a)({},n)):(await new Promise((t=>{var e,s;return setTimeout(t,(null===(e=this.services.setting)||void 0===e||null===(s=e.fetching)||void 0===s?void 0:s.debounceBetweenFetch)||5e3)})),null!=s&&s.aborted||(null==s||s.abort(),null==s||s.abortFetch(),s===this.fetcher&&(this.fetcher=void 0),this.emitter.emit(C.c.DOMResp,{type:"RUNNING",module:C.i.Fetcher}))))}listenOnEvents(){this.emitter.on(C.c.DOMReq,(t=>{var e,s;switch(t.type){case"RUNNING":case"RESUME":t.module!=this.symbol||this.fetcher||(this.fetcher=new $(this.services,this.logger),this.fetch());break;case"PAUSE":case"STOP":case"RESTART":null===(e=this.fetcher)||void 0===e||e.abort(),null===(s=this.fetcher)||void 0===s||s.abortFetch(),this.fetcher=void 0;break;case"GROUPLEAVE":var i;if(t.module==this.symbol&&this.fetcher)this.services.leaveGroups.has(this.services.getFetchingGroupId())&&(null===(i=this.fetcher)||void 0===i||i.abortFetch())}}))}removeOnEvents(){this.emitter.removeAllListeners(C.c.DOMReq)}}var H=s("xx6F"),B=s("MPLC"),V=s("Mgpg");e.default=(async()=>{const t=r.ModuleContainer.resolve(o.a),e=r.ModuleContainer.resolve(V.ZLoggerFactory),s=r.ModuleContainer.resolve(l.b),c=r.ModuleContainer.resolve(l.f);let g=e.createZLogger("dl_old_media",["svc"]),u=e.createZLogger("dl_old_media",["ctl"]),d=new n.EventEmitter,m=new G(a.default,s,c,h.b,H.UIConCurDownload,r.ModuleContainer.resolve(i.a),g);new z(d,m,g),new k(d,m,g);return new U(d,m,t,B.a,null,u)})()}}]);
//# sourceMappingURL=../sourcemaps/lazy/42.4279ee5095da4aa3492e.js.map